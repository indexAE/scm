{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/indexae/Desktop/scm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/indexae/Desktop/scm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.date.to-iso-string.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport { ref } from 'vue';\nimport { ElMessage } from 'element-plus';\n\n// 日志数据\n\nexport default {\n  __name: 'LoginLog',\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose;\n    __expose();\n    var logs = ref([]);\n    var total = ref(0);\n    var currentPage = ref(1);\n    var pageSize = ref(10);\n    var dateRange = ref([]);\n\n    // 日期快捷选项\n    var shortcuts = [{\n      text: '最近一周',\n      value: function value() {\n        var end = new Date();\n        var start = new Date();\n        start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);\n        return [start, end];\n      }\n    }, {\n      text: '最近一个月',\n      value: function value() {\n        var end = new Date();\n        var start = new Date();\n        start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);\n        return [start, end];\n      }\n    }, {\n      text: '最近三个月',\n      value: function value() {\n        var end = new Date();\n        var start = new Date();\n        start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);\n        return [start, end];\n      }\n    }];\n\n    // 获取日志列表\n    var getLogs = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var url, startDate, endDate, res, data;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              url = \"http://localhost:8000/api/logs/login?page=\".concat(currentPage.value, \"&size=\").concat(pageSize.value); // 添加日期范围参数\n              if (dateRange.value && dateRange.value.length === 2) {\n                startDate = dateRange.value[0].toISOString().split('T')[0];\n                endDate = dateRange.value[1].toISOString().split('T')[0];\n                url += \"&startDate=\".concat(startDate, \"&endDate=\").concat(endDate);\n              }\n              _context.next = 5;\n              return fetch(url, {\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                credentials: 'include'\n              });\n            case 5:\n              res = _context.sent;\n              _context.next = 8;\n              return res.json();\n            case 8:\n              data = _context.sent;\n              if (data.code === 0) {\n                logs.value = data.data.records;\n                total.value = data.data.total;\n              } else {\n                ElMessage.error(data.message || '获取登录日志失败');\n              }\n              _context.next = 16;\n              break;\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context[\"catch\"](0);\n              console.error('获取登录日志失败:', _context.t0);\n              ElMessage.error('获取登录日志失败');\n            case 16:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 12]]);\n      }));\n      return function getLogs() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    // 处理日期变化\n    var handleDateChange = function handleDateChange() {\n      currentPage.value = 1;\n    };\n\n    // 处理查询\n    var handleSearch = function handleSearch() {\n      getLogs();\n    };\n\n    // 处理每页数量变化\n    var handleSizeChange = function handleSizeChange(val) {\n      pageSize.value = val;\n      getLogs();\n    };\n\n    // 处理页码变化\n    var handleCurrentChange = function handleCurrentChange(val) {\n      currentPage.value = val;\n      getLogs();\n    };\n\n    // 初始化\n    getLogs();\n    var __returned__ = {\n      logs: logs,\n      total: total,\n      currentPage: currentPage,\n      pageSize: pageSize,\n      dateRange: dateRange,\n      shortcuts: shortcuts,\n      getLogs: getLogs,\n      handleDateChange: handleDateChange,\n      handleSearch: handleSearch,\n      handleSizeChange: handleSizeChange,\n      handleCurrentChange: handleCurrentChange,\n      ref: ref,\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","ElMessage","logs","total","currentPage","pageSize","dateRange","shortcuts","text","value","end","Date","start","setTime","getTime","getLogs","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","url","startDate","endDate","res","data","wrap","_callee$","_context","prev","next","concat","length","toISOString","split","fetch","headers","credentials","sent","json","code","records","error","message","t0","console","stop","apply","arguments","handleDateChange","handleSearch","handleSizeChange","val","handleCurrentChange"],"sources":["C:/Users/indexae/Desktop/scm/frontend/src/views/LoginLog.vue"],"sourcesContent":["<template>\r\n  <div class=\"login-log\">\r\n    <el-card class=\"box-card\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>登录日志</span>\r\n          <div class=\"header-operations\">\r\n            <el-date-picker\r\n              v-model=\"dateRange\"\r\n              type=\"daterange\"\r\n              range-separator=\"至\"\r\n              start-placeholder=\"开始日期\"\r\n              end-placeholder=\"结束日期\"\r\n              :shortcuts=\"shortcuts\"\r\n              @change=\"handleDateChange\"\r\n            />\r\n            <el-button type=\"primary\" @click=\"handleSearch\">查询</el-button>\r\n          </div>\r\n        </div>\r\n      </template>\r\n      \r\n      <!-- 日志列表 -->\r\n      <el-table :data=\"logs\" style=\"width: 100%\">\r\n        <el-table-column prop=\"id\" label=\"ID\" width=\"80\" />\r\n        <el-table-column prop=\"username\" label=\"用户名\" width=\"120\" />\r\n        <el-table-column prop=\"ip\" label=\"IP地址\" width=\"120\" />\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"scope.row.status ? 'success' : 'danger'\">\r\n              {{ scope.row.status ? '成功' : '失败' }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"message\" label=\"消息\" />\r\n        <el-table-column prop=\"browser\" label=\"浏览器\" width=\"120\" />\r\n        <el-table-column prop=\"os\" label=\"操作系统\" width=\"120\" />\r\n        <el-table-column prop=\"createTime\" label=\"登录时间\" width=\"180\" />\r\n      </el-table>\r\n      \r\n      <!-- 分页 -->\r\n      <div class=\"pagination\">\r\n        <el-pagination\r\n          v-model:current-page=\"currentPage\"\r\n          v-model:page-size=\"pageSize\"\r\n          :page-sizes=\"[10, 20, 50, 100]\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"total\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\n\r\n// 日志数据\r\nconst logs = ref([])\r\nconst total = ref(0)\r\nconst currentPage = ref(1)\r\nconst pageSize = ref(10)\r\nconst dateRange = ref([])\r\n\r\n// 日期快捷选项\r\nconst shortcuts = [\r\n  {\r\n    text: '最近一周',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setTime(start.getTime() - 3600 * 1000 * 24 * 7)\r\n      return [start, end]\r\n    },\r\n  },\r\n  {\r\n    text: '最近一个月',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setTime(start.getTime() - 3600 * 1000 * 24 * 30)\r\n      return [start, end]\r\n    },\r\n  },\r\n  {\r\n    text: '最近三个月',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setTime(start.getTime() - 3600 * 1000 * 24 * 90)\r\n      return [start, end]\r\n    },\r\n  },\r\n]\r\n\r\n// 获取日志列表\r\nconst getLogs = async () => {\r\n  try {\r\n    let url = `http://localhost:8000/api/logs/login?page=${currentPage.value}&size=${pageSize.value}`\r\n    \r\n    // 添加日期范围参数\r\n    if (dateRange.value && dateRange.value.length === 2) {\r\n      const startDate = dateRange.value[0].toISOString().split('T')[0]\r\n      const endDate = dateRange.value[1].toISOString().split('T')[0]\r\n      url += `&startDate=${startDate}&endDate=${endDate}`\r\n    }\r\n    \r\n    const res = await fetch(url, {\r\n      headers: {\r\n        'Content-Type': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    const data = await res.json()\r\n    if (data.code === 0) {\r\n      logs.value = data.data.records\r\n      total.value = data.data.total\r\n    } else {\r\n      ElMessage.error(data.message || '获取登录日志失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取登录日志失败:', error)\r\n    ElMessage.error('获取登录日志失败')\r\n  }\r\n}\r\n\r\n// 处理日期变化\r\nconst handleDateChange = () => {\r\n  currentPage.value = 1\r\n}\r\n\r\n// 处理查询\r\nconst handleSearch = () => {\r\n  getLogs()\r\n}\r\n\r\n// 处理每页数量变化\r\nconst handleSizeChange = (val) => {\r\n  pageSize.value = val\r\n  getLogs()\r\n}\r\n\r\n// 处理页码变化\r\nconst handleCurrentChange = (val) => {\r\n  currentPage.value = val\r\n  getLogs()\r\n}\r\n\r\n// 初始化\r\ngetLogs()\r\n</script>\r\n\r\n<style scoped>\r\n.login-log {\r\n  padding: 20px;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.header-operations {\r\n  display: flex;\r\n  gap: 10px;\r\n}\r\n\r\n.pagination {\r\n  margin-top: 20px;\r\n  display: flex;\r\n  justify-content: flex-end;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}