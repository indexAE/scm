{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createTextVNode as _createTextVNode, withCtx as _withCtx, createCommentVNode as _createCommentVNode, toDisplayString as _toDisplayString, openBlock as _openBlock, createBlock as _createBlock, normalizeClass as _normalizeClass, createElementBlock as _createElementBlock } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"finance-report\"\n};\nvar _hoisted_2 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_3 = {\n  \"class\": \"header-right\"\n};\nvar _hoisted_4 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_5 = {\n  \"class\": \"card-amount\"\n};\nvar _hoisted_6 = {\n  \"class\": \"amount\"\n};\nvar _hoisted_7 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_8 = {\n  \"class\": \"card-amount\"\n};\nvar _hoisted_9 = {\n  \"class\": \"amount\"\n};\nvar _hoisted_10 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_11 = {\n  \"class\": \"card-amount\"\n};\nvar _hoisted_12 = {\n  \"class\": \"charts-container\"\n};\nvar _hoisted_13 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_14 = {\n  ref: \"trendChartRef\",\n  \"class\": \"chart\"\n};\nvar _hoisted_15 = {\n  ref: \"incomeChartRef\",\n  \"class\": \"chart\"\n};\nvar _hoisted_16 = {\n  ref: \"expenseChartRef\",\n  \"class\": \"chart\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_el_date_picker = _resolveComponent(\"el-date-picker\");\n  var _component_el_button = _resolveComponent(\"el-button\");\n  var _component_el_tag = _resolveComponent(\"el-tag\");\n  var _component_el_icon = _resolveComponent(\"el-icon\");\n  var _component_el_card = _resolveComponent(\"el-card\");\n  var _component_el_col = _resolveComponent(\"el-col\");\n  var _component_el_row = _resolveComponent(\"el-row\");\n  var _component_el_radio_button = _resolveComponent(\"el-radio-button\");\n  var _component_el_radio_group = _resolveComponent(\"el-radio-group\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_card, null, {\n    header: _withCtx(function () {\n      return [_createElementVNode(\"div\", _hoisted_2, [_cache[3] || (_cache[3] = _createElementVNode(\"span\", null, \"财务报表\", -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_3, [_createVNode(_component_el_date_picker, {\n        modelValue: $setup.dateRange,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n          return $setup.dateRange = $event;\n        }),\n        type: \"daterange\",\n        \"range-separator\": \"至\",\n        \"start-placeholder\": \"开始日期\",\n        \"end-placeholder\": \"结束日期\",\n        shortcuts: $setup.dateShortcuts,\n        onChange: $setup.handleDateChange\n      }, null, 8 /* PROPS */, [\"modelValue\"]), _createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $setup.handleExport\n      }, {\n        \"default\": _withCtx(function () {\n          return _cache[2] || (_cache[2] = [_createTextVNode(\"导出报表\")]);\n        }),\n        _: 1 /* STABLE */\n      })])])];\n    }),\n    \"default\": _withCtx(function () {\n      return [_createVNode(_component_el_row, {\n        gutter: 20,\n        \"class\": \"statistics-cards\"\n      }, {\n        \"default\": _withCtx(function () {\n          return [_createVNode(_component_el_col, {\n            span: 8\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_card, {\n                shadow: \"hover\"\n              }, {\n                header: _withCtx(function () {\n                  return [_createElementVNode(\"div\", _hoisted_4, [_cache[4] || (_cache[4] = _createElementVNode(\"span\", null, \"总收入\", -1 /* HOISTED */)), _createVNode(_component_el_tag, {\n                    type: \"success\"\n                  }, {\n                    \"default\": _withCtx(function () {\n                      return [_createTextVNode(_toDisplayString($setup.dateRangeText), 1 /* TEXT */)];\n                    }),\n                    _: 1 /* STABLE */\n                  })])];\n                }),\n                \"default\": _withCtx(function () {\n                  return [_createElementVNode(\"div\", _hoisted_5, [_createElementVNode(\"span\", _hoisted_6, \"¥\" + _toDisplayString($setup.totalIncome), 1 /* TEXT */), _createElementVNode(\"span\", {\n                    \"class\": _normalizeClass([\"trend\", {\n                      up: $setup.incomeTrend > 0,\n                      down: $setup.incomeTrend < 0\n                    }])\n                  }, [_createTextVNode(_toDisplayString(Math.abs($setup.incomeTrend)) + \"% \", 1 /* TEXT */), _createVNode(_component_el_icon, null, {\n                    \"default\": _withCtx(function () {\n                      return [$setup.incomeTrend > 0 ? (_openBlock(), _createBlock($setup[\"ArrowUp\"], {\n                        key: 0\n                      })) : _createCommentVNode(\"v-if\", true), $setup.incomeTrend < 0 ? (_openBlock(), _createBlock($setup[\"ArrowDown\"], {\n                        key: 1\n                      })) : _createCommentVNode(\"v-if\", true)];\n                    }),\n                    _: 1 /* STABLE */\n                  })], 2 /* CLASS */)])];\n                }),\n                _: 1 /* STABLE */\n              })];\n            }),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_col, {\n            span: 8\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_card, {\n                shadow: \"hover\"\n              }, {\n                header: _withCtx(function () {\n                  return [_createElementVNode(\"div\", _hoisted_7, [_cache[5] || (_cache[5] = _createElementVNode(\"span\", null, \"总支出\", -1 /* HOISTED */)), _createVNode(_component_el_tag, {\n                    type: \"danger\"\n                  }, {\n                    \"default\": _withCtx(function () {\n                      return [_createTextVNode(_toDisplayString($setup.dateRangeText), 1 /* TEXT */)];\n                    }),\n                    _: 1 /* STABLE */\n                  })])];\n                }),\n                \"default\": _withCtx(function () {\n                  return [_createElementVNode(\"div\", _hoisted_8, [_createElementVNode(\"span\", _hoisted_9, \"¥\" + _toDisplayString($setup.totalExpense), 1 /* TEXT */), _createElementVNode(\"span\", {\n                    \"class\": _normalizeClass([\"trend\", {\n                      up: $setup.expenseTrend > 0,\n                      down: $setup.expenseTrend < 0\n                    }])\n                  }, [_createTextVNode(_toDisplayString(Math.abs($setup.expenseTrend)) + \"% \", 1 /* TEXT */), _createVNode(_component_el_icon, null, {\n                    \"default\": _withCtx(function () {\n                      return [$setup.expenseTrend > 0 ? (_openBlock(), _createBlock($setup[\"ArrowUp\"], {\n                        key: 0\n                      })) : _createCommentVNode(\"v-if\", true), $setup.expenseTrend < 0 ? (_openBlock(), _createBlock($setup[\"ArrowDown\"], {\n                        key: 1\n                      })) : _createCommentVNode(\"v-if\", true)];\n                    }),\n                    _: 1 /* STABLE */\n                  })], 2 /* CLASS */)])];\n                }),\n                _: 1 /* STABLE */\n              })];\n            }),\n            _: 1 /* STABLE */\n          }), _createVNode(_component_el_col, {\n            span: 8\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_card, {\n                shadow: \"hover\"\n              }, {\n                header: _withCtx(function () {\n                  return [_createElementVNode(\"div\", _hoisted_10, [_cache[6] || (_cache[6] = _createElementVNode(\"span\", null, \"净收入\", -1 /* HOISTED */)), _createVNode(_component_el_tag, {\n                    type: \"info\"\n                  }, {\n                    \"default\": _withCtx(function () {\n                      return [_createTextVNode(_toDisplayString($setup.dateRangeText), 1 /* TEXT */)];\n                    }),\n                    _: 1 /* STABLE */\n                  })])];\n                }),\n                \"default\": _withCtx(function () {\n                  return [_createElementVNode(\"div\", _hoisted_11, [_createElementVNode(\"span\", {\n                    \"class\": _normalizeClass([\"amount\", {\n                      'negative': $setup.netIncome < 0\n                    }])\n                  }, \"¥\" + _toDisplayString($setup.netIncome), 3 /* TEXT, CLASS */), _createElementVNode(\"span\", {\n                    \"class\": _normalizeClass([\"trend\", {\n                      up: $setup.netIncomeTrend > 0,\n                      down: $setup.netIncomeTrend < 0\n                    }])\n                  }, [_createTextVNode(_toDisplayString(Math.abs($setup.netIncomeTrend)) + \"% \", 1 /* TEXT */), _createVNode(_component_el_icon, null, {\n                    \"default\": _withCtx(function () {\n                      return [$setup.netIncomeTrend > 0 ? (_openBlock(), _createBlock($setup[\"ArrowUp\"], {\n                        key: 0\n                      })) : _createCommentVNode(\"v-if\", true), $setup.netIncomeTrend < 0 ? (_openBlock(), _createBlock($setup[\"ArrowDown\"], {\n                        key: 1\n                      })) : _createCommentVNode(\"v-if\", true)];\n                    }),\n                    _: 1 /* STABLE */\n                  })], 2 /* CLASS */)])];\n                }),\n                _: 1 /* STABLE */\n              })];\n            }),\n            _: 1 /* STABLE */\n          })];\n        }),\n        _: 1 /* STABLE */\n      }), _createElementVNode(\"div\", _hoisted_12, [_createCommentVNode(\" 收支趋势图 \"), _createVNode(_component_el_card, {\n        \"class\": \"chart-card\"\n      }, {\n        header: _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_13, [_cache[10] || (_cache[10] = _createElementVNode(\"span\", null, \"收支趋势\", -1 /* HOISTED */)), _createVNode(_component_el_radio_group, {\n            modelValue: $setup.trendType,\n            \"onUpdate:modelValue\": _cache[1] || (_cache[1] = function ($event) {\n              return $setup.trendType = $event;\n            }),\n            size: \"small\"\n          }, {\n            \"default\": _withCtx(function () {\n              return [_createVNode(_component_el_radio_button, {\n                label: \"day\"\n              }, {\n                \"default\": _withCtx(function () {\n                  return _cache[7] || (_cache[7] = [_createTextVNode(\"日\")]);\n                }),\n                _: 1 /* STABLE */\n              }), _createVNode(_component_el_radio_button, {\n                label: \"week\"\n              }, {\n                \"default\": _withCtx(function () {\n                  return _cache[8] || (_cache[8] = [_createTextVNode(\"周\")]);\n                }),\n                _: 1 /* STABLE */\n              }), _createVNode(_component_el_radio_button, {\n                label: \"month\"\n              }, {\n                \"default\": _withCtx(function () {\n                  return _cache[9] || (_cache[9] = [_createTextVNode(\"月\")]);\n                }),\n                _: 1 /* STABLE */\n              })];\n            }),\n            _: 1 /* STABLE */\n          }, 8 /* PROPS */, [\"modelValue\"])])];\n        }),\n        \"default\": _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_14, null, 512 /* NEED_PATCH */)];\n        }),\n        _: 1 /* STABLE */\n      }), _createCommentVNode(\" 收入构成 \"), _createVNode(_component_el_card, {\n        \"class\": \"chart-card\"\n      }, {\n        header: _withCtx(function () {\n          return _cache[11] || (_cache[11] = [_createElementVNode(\"div\", {\n            \"class\": \"card-header\"\n          }, [_createElementVNode(\"span\", null, \"收入构成\")], -1 /* HOISTED */)]);\n        }),\n        \"default\": _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_15, null, 512 /* NEED_PATCH */)];\n        }),\n        _: 1 /* STABLE */\n      }), _createCommentVNode(\" 支出构成 \"), _createVNode(_component_el_card, {\n        \"class\": \"chart-card\"\n      }, {\n        header: _withCtx(function () {\n          return _cache[12] || (_cache[12] = [_createElementVNode(\"div\", {\n            \"class\": \"card-header\"\n          }, [_createElementVNode(\"span\", null, \"支出构成\")], -1 /* HOISTED */)]);\n        }),\n        \"default\": _withCtx(function () {\n          return [_createElementVNode(\"div\", _hoisted_16, null, 512 /* NEED_PATCH */)];\n        }),\n        _: 1 /* STABLE */\n      })])];\n    }),\n    _: 1 /* STABLE */\n  })]);\n}","map":{"version":3,"names":["ref","_createElementBlock","_hoisted_1","_createVNode","_component_el_card","header","_withCtx","_createElementVNode","_hoisted_2","_hoisted_3","_component_el_date_picker","modelValue","$setup","dateRange","_cache","$event","type","shortcuts","dateShortcuts","onChange","handleDateChange","_component_el_button","onClick","handleExport","_createTextVNode","_","_component_el_row","gutter","_component_el_col","span","shadow","_hoisted_4","_component_el_tag","_toDisplayString","dateRangeText","_hoisted_5","_hoisted_6","totalIncome","_normalizeClass","up","incomeTrend","down","Math","abs","_component_el_icon","_createBlock","key","_createCommentVNode","_hoisted_7","_hoisted_8","_hoisted_9","totalExpense","expenseTrend","_hoisted_10","_hoisted_11","netIncome","netIncomeTrend","_hoisted_12","_hoisted_13","_component_el_radio_group","trendType","size","_component_el_radio_button","label","_hoisted_14","_hoisted_15","_hoisted_16"],"sources":["C:\\Users\\indexae\\Desktop\\scm退货\\scm\\frontend\\src\\views\\finance\\report\\index.vue"],"sourcesContent":["<template>\r\n  <div class=\"finance-report\">\r\n    <el-card>\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>财务报表</span>\r\n          <div class=\"header-right\">\r\n            <el-date-picker\r\n              v-model=\"dateRange\"\r\n              type=\"daterange\"\r\n              range-separator=\"至\"\r\n              start-placeholder=\"开始日期\"\r\n              end-placeholder=\"结束日期\"\r\n              :shortcuts=\"dateShortcuts\"\r\n              @change=\"handleDateChange\"\r\n            />\r\n            <el-button type=\"primary\" @click=\"handleExport\">导出报表</el-button>\r\n          </div>\r\n        </div>\r\n      </template>\r\n\r\n      <!-- 统计卡片 -->\r\n      <el-row :gutter=\"20\" class=\"statistics-cards\">\r\n        <el-col :span=\"8\">\r\n          <el-card shadow=\"hover\">\r\n            <template #header>\r\n              <div class=\"card-header\">\r\n                <span>总收入</span>\r\n                <el-tag type=\"success\">{{ dateRangeText }}</el-tag>\r\n              </div>\r\n            </template>\r\n            <div class=\"card-amount\">\r\n              <span class=\"amount\">¥{{ totalIncome }}</span>\r\n              <span class=\"trend\" :class=\"{ up: incomeTrend > 0, down: incomeTrend < 0 }\">\r\n                {{ Math.abs(incomeTrend) }}%\r\n                <el-icon><ArrowUp v-if=\"incomeTrend > 0\" /><ArrowDown v-if=\"incomeTrend < 0\" /></el-icon>\r\n              </span>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-card shadow=\"hover\">\r\n            <template #header>\r\n              <div class=\"card-header\">\r\n                <span>总支出</span>\r\n                <el-tag type=\"danger\">{{ dateRangeText }}</el-tag>\r\n              </div>\r\n            </template>\r\n            <div class=\"card-amount\">\r\n              <span class=\"amount\">¥{{ totalExpense }}</span>\r\n              <span class=\"trend\" :class=\"{ up: expenseTrend > 0, down: expenseTrend < 0 }\">\r\n                {{ Math.abs(expenseTrend) }}%\r\n                <el-icon><ArrowUp v-if=\"expenseTrend > 0\" /><ArrowDown v-if=\"expenseTrend < 0\" /></el-icon>\r\n              </span>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n        <el-col :span=\"8\">\r\n          <el-card shadow=\"hover\">\r\n            <template #header>\r\n              <div class=\"card-header\">\r\n                <span>净收入</span>\r\n                <el-tag type=\"info\">{{ dateRangeText }}</el-tag>\r\n              </div>\r\n            </template>\r\n            <div class=\"card-amount\">\r\n              <span class=\"amount\" :class=\"{ 'negative': netIncome < 0 }\">¥{{ netIncome }}</span>\r\n              <span class=\"trend\" :class=\"{ up: netIncomeTrend > 0, down: netIncomeTrend < 0 }\">\r\n                {{ Math.abs(netIncomeTrend) }}%\r\n                <el-icon><ArrowUp v-if=\"netIncomeTrend > 0\" /><ArrowDown v-if=\"netIncomeTrend < 0\" /></el-icon>\r\n              </span>\r\n            </div>\r\n          </el-card>\r\n        </el-col>\r\n      </el-row>\r\n\r\n      <!-- 图表区域 -->\r\n      <div class=\"charts-container\">\r\n        <!-- 收支趋势图 -->\r\n        <el-card class=\"chart-card\">\r\n          <template #header>\r\n            <div class=\"card-header\">\r\n              <span>收支趋势</span>\r\n              <el-radio-group v-model=\"trendType\" size=\"small\">\r\n                <el-radio-button label=\"day\">日</el-radio-button>\r\n                <el-radio-button label=\"week\">周</el-radio-button>\r\n                <el-radio-button label=\"month\">月</el-radio-button>\r\n              </el-radio-group>\r\n            </div>\r\n          </template>\r\n          <div ref=\"trendChartRef\" class=\"chart\"></div>\r\n        </el-card>\r\n\r\n        <!-- 收入构成 -->\r\n        <el-card class=\"chart-card\">\r\n          <template #header>\r\n            <div class=\"card-header\">\r\n              <span>收入构成</span>\r\n            </div>\r\n          </template>\r\n          <div ref=\"incomeChartRef\" class=\"chart\"></div>\r\n        </el-card>\r\n\r\n        <!-- 支出构成 -->\r\n        <el-card class=\"chart-card\">\r\n          <template #header>\r\n            <div class=\"card-header\">\r\n              <span>支出构成</span>\r\n            </div>\r\n          </template>\r\n          <div ref=\"expenseChartRef\" class=\"chart\"></div>\r\n        </el-card>\r\n      </div>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed, onUnmounted } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport { ArrowUp, ArrowDown } from '@element-plus/icons-vue'\r\nimport * as echarts from 'echarts'\r\n\r\n// 日期范围快捷选项\r\nconst dateShortcuts = [\r\n  {\r\n    text: '最近一周',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setTime(start.getTime() - 3600 * 1000 * 24 * 7)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    text: '最近一个月',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setMonth(start.getMonth() - 1)\r\n      return [start, end]\r\n    }\r\n  },\r\n  {\r\n    text: '最近三个月',\r\n    value: () => {\r\n      const end = new Date()\r\n      const start = new Date()\r\n      start.setMonth(start.getMonth() - 3)\r\n      return [start, end]\r\n    }\r\n  }\r\n]\r\n\r\n// 数据\r\nconst dateRange = ref([])\r\nconst trendType = ref('day')\r\nconst loading = ref(false)\r\nconst totalIncome = ref(0)\r\nconst totalExpense = ref(0)\r\nconst incomeTrend = ref(0)\r\nconst expenseTrend = ref(0)\r\n\r\n// 图表引用\r\nconst trendChartRef = ref(null)\r\nconst incomeChartRef = ref(null)\r\nconst expenseChartRef = ref(null)\r\nlet trendChart = null\r\nlet incomeChart = null\r\nlet expenseChart = null\r\n\r\n// 计算属性\r\nconst netIncome = computed(() => totalIncome.value - totalExpense.value)\r\nconst netIncomeTrend = computed(() => {\r\n  if (totalIncome.value === 0 && totalExpense.value === 0) return 0\r\n  return ((totalIncome.value - totalExpense.value) / Math.max(totalIncome.value, totalExpense.value)) * 100\r\n})\r\n\r\nconst dateRangeText = computed(() => {\r\n  if (!dateRange.value || !dateRange.value[0] || !dateRange.value[1]) return ''\r\n  const start = dateRange.value[0].toLocaleDateString()\r\n  const end = dateRange.value[1].toLocaleDateString()\r\n  return `${start} 至 ${end}`\r\n})\r\n\r\n// 获取财务数据\r\nconst getFinanceData = async () => {\r\n  if (!dateRange.value || !dateRange.value[0] || !dateRange.value[1]) return\r\n  \r\n  loading.value = true\r\n  try {\r\n    const params = {\r\n      startDate: dateRange.value[0].toISOString().split('T')[0],\r\n      endDate: dateRange.value[1].toISOString().split('T')[0],\r\n      type: trendType.value\r\n    }\r\n    \r\n    const response = await fetch(`http://127.0.0.1:8080/api/finance/report?${new URLSearchParams(params)}`, {\r\n      headers: {\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    \r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      const data = result.data\r\n      totalIncome.value = data.totalIncome\r\n      totalExpense.value = data.totalExpense\r\n      incomeTrend.value = data.incomeTrend\r\n      expenseTrend.value = data.expenseTrend\r\n      \r\n      // 更新图表\r\n      updateTrendChart(data.trend)\r\n      updateIncomeChart(data.incomeComposition)\r\n      updateExpenseChart(data.expenseComposition)\r\n    } else {\r\n      ElMessage.error(result.message || '获取财务数据失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取财务数据失败:', error)\r\n    ElMessage.error('获取财务数据失败')\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\n// 初始化趋势图\r\nconst initTrendChart = () => {\r\n  trendChart = echarts.init(trendChartRef.value)\r\n  const option = {\r\n    tooltip: {\r\n      trigger: 'axis',\r\n      axisPointer: {\r\n        type: 'cross',\r\n        label: {\r\n          backgroundColor: '#6a7985'\r\n        }\r\n      }\r\n    },\r\n    legend: {\r\n      data: ['收入', '支出', '净收入']\r\n    },\r\n    grid: {\r\n      left: '3%',\r\n      right: '4%',\r\n      bottom: '3%',\r\n      containLabel: true\r\n    },\r\n    xAxis: {\r\n      type: 'category',\r\n      boundaryGap: false,\r\n      data: []\r\n    },\r\n    yAxis: {\r\n      type: 'value'\r\n    },\r\n    series: [\r\n      {\r\n        name: '收入',\r\n        type: 'line',\r\n        stack: 'Total',\r\n        areaStyle: {},\r\n        emphasis: {\r\n          focus: 'series'\r\n        },\r\n        data: []\r\n      },\r\n      {\r\n        name: '支出',\r\n        type: 'line',\r\n        stack: 'Total',\r\n        areaStyle: {},\r\n        emphasis: {\r\n          focus: 'series'\r\n        },\r\n        data: []\r\n      },\r\n      {\r\n        name: '净收入',\r\n        type: 'line',\r\n        emphasis: {\r\n          focus: 'series'\r\n        },\r\n        data: []\r\n      }\r\n    ]\r\n  }\r\n  trendChart.setOption(option)\r\n}\r\n\r\n// 初始化收入构成图\r\nconst initIncomeChart = () => {\r\n  incomeChart = echarts.init(incomeChartRef.value)\r\n  const option = {\r\n    tooltip: {\r\n      trigger: 'item',\r\n      formatter: '{a} <br/>{b}: {c} ({d}%)'\r\n    },\r\n    legend: {\r\n      orient: 'vertical',\r\n      left: 10,\r\n      data: ['销售收入', '其他收入']\r\n    },\r\n    series: [\r\n      {\r\n        name: '收入构成',\r\n        type: 'pie',\r\n        radius: ['50%', '70%'],\r\n        avoidLabelOverlap: false,\r\n        itemStyle: {\r\n          borderRadius: 10,\r\n          borderColor: '#fff',\r\n          borderWidth: 2\r\n        },\r\n        label: {\r\n          show: false,\r\n          position: 'center'\r\n        },\r\n        emphasis: {\r\n          label: {\r\n            show: true,\r\n            fontSize: '20',\r\n            fontWeight: 'bold'\r\n          }\r\n        },\r\n        labelLine: {\r\n          show: false\r\n        },\r\n        data: []\r\n      }\r\n    ]\r\n  }\r\n  incomeChart.setOption(option)\r\n}\r\n\r\n// 初始化支出构成图\r\nconst initExpenseChart = () => {\r\n  expenseChart = echarts.init(expenseChartRef.value)\r\n  const option = {\r\n    tooltip: {\r\n      trigger: 'item',\r\n      formatter: '{a} <br/>{b}: {c} ({d}%)'\r\n    },\r\n    legend: {\r\n      orient: 'vertical',\r\n      left: 10,\r\n      data: ['采购支出', '其他支出']\r\n    },\r\n    series: [\r\n      {\r\n        name: '支出构成',\r\n        type: 'pie',\r\n        radius: ['50%', '70%'],\r\n        avoidLabelOverlap: false,\r\n        itemStyle: {\r\n          borderRadius: 10,\r\n          borderColor: '#fff',\r\n          borderWidth: 2\r\n        },\r\n        label: {\r\n          show: false,\r\n          position: 'center'\r\n        },\r\n        emphasis: {\r\n          label: {\r\n            show: true,\r\n            fontSize: '20',\r\n            fontWeight: 'bold'\r\n          }\r\n        },\r\n        labelLine: {\r\n          show: false\r\n        },\r\n        data: []\r\n      }\r\n    ]\r\n  }\r\n  expenseChart.setOption(option)\r\n}\r\n\r\n// 更新趋势图数据\r\nconst updateTrendChart = (data) => {\r\n  const option = {\r\n    xAxis: {\r\n      data: data.dates\r\n    },\r\n    series: [\r\n      {\r\n        name: '收入',\r\n        data: data.incomes\r\n      },\r\n      {\r\n        name: '支出',\r\n        data: data.expenses\r\n      },\r\n      {\r\n        name: '净收入',\r\n        data: data.netIncomes\r\n      }\r\n    ]\r\n  }\r\n  trendChart.setOption(option)\r\n}\r\n\r\n// 更新收入构成图数据\r\nconst updateIncomeChart = (data) => {\r\n  const option = {\r\n    series: [\r\n      {\r\n        data: [\r\n          { value: data.sale, name: '销售收入' },\r\n          { value: data.other, name: '其他收入' }\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n  incomeChart.setOption(option)\r\n}\r\n\r\n// 更新支出构成图数据\r\nconst updateExpenseChart = (data) => {\r\n  const option = {\r\n    series: [\r\n      {\r\n        data: [\r\n          { value: data.purchase, name: '采购支出' },\r\n          { value: data.other, name: '其他支出' }\r\n        ]\r\n      }\r\n    ]\r\n  }\r\n  expenseChart.setOption(option)\r\n}\r\n\r\n// 处理日期变化\r\nconst handleDateChange = () => {\r\n  getFinanceData()\r\n}\r\n\r\n// 导出报表\r\nconst handleExport = async () => {\r\n  if (!dateRange.value || !dateRange.value[0] || !dateRange.value[1]) {\r\n    ElMessage.warning('请先选择日期范围')\r\n    return\r\n  }\r\n  \r\n  try {\r\n    const params = {\r\n      startDate: dateRange.value[0].toISOString().split('T')[0],\r\n      endDate: dateRange.value[1].toISOString().split('T')[0]\r\n    }\r\n    \r\n    const response = await fetch(`http://127.0.0.1:8080/api/finance/report/export?${new URLSearchParams(params)}`, {\r\n      headers: {\r\n        'Accept': 'application/octet-stream'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    \r\n    if (response.ok) {\r\n      const blob = await response.blob()\r\n      const url = window.URL.createObjectURL(blob)\r\n      const link = document.createElement('a')\r\n      link.href = url\r\n      link.download = `财务报表_${params.startDate}_${params.endDate}.xlsx`\r\n      document.body.appendChild(link)\r\n      link.click()\r\n      document.body.removeChild(link)\r\n      window.URL.revokeObjectURL(url)\r\n    } else {\r\n      const error = await response.json()\r\n      ElMessage.error(error.message || '导出报表失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('导出报表失败:', error)\r\n    ElMessage.error('导出报表失败')\r\n  }\r\n}\r\n\r\n// 监听窗口大小变化\r\nconst handleResize = () => {\r\n  trendChart?.resize()\r\n  incomeChart?.resize()\r\n  expenseChart?.resize()\r\n}\r\n\r\n// 初始化\r\nonMounted(() => {\r\n  // 设置默认日期范围为最近一个月\r\n  const end = new Date()\r\n  const start = new Date()\r\n  start.setMonth(start.getMonth() - 1)\r\n  dateRange.value = [start, end]\r\n  \r\n  // 初始化图表\r\n  initTrendChart()\r\n  initIncomeChart()\r\n  initExpenseChart()\r\n  \r\n  // 获取数据\r\n  getFinanceData()\r\n  \r\n  // 监听窗口大小变化\r\n  window.addEventListener('resize', handleResize)\r\n})\r\n\r\n// 组件卸载时移除事件监听\r\nonUnmounted(() => {\r\n  window.removeEventListener('resize', handleResize)\r\n  trendChart?.dispose()\r\n  incomeChart?.dispose()\r\n  expenseChart?.dispose()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.finance-report {\r\n  padding: 20px;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.header-right {\r\n  display: flex;\r\n  gap: 16px;\r\n  align-items: center;\r\n}\r\n\r\n.statistics-cards {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.card-amount {\r\n  display: flex;\r\n  align-items: baseline;\r\n  gap: 16px;\r\n}\r\n\r\n.amount {\r\n  font-size: 24px;\r\n  font-weight: bold;\r\n}\r\n\r\n.amount.negative {\r\n  color: #f56c6c;\r\n}\r\n\r\n.trend {\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 4px;\r\n  font-size: 14px;\r\n}\r\n\r\n.trend.up {\r\n  color: #67c23a;\r\n}\r\n\r\n.trend.down {\r\n  color: #f56c6c;\r\n}\r\n\r\n.charts-container {\r\n  display: grid;\r\n  grid-template-columns: repeat(2, 1fr);\r\n  gap: 20px;\r\n  margin-top: 20px;\r\n}\r\n\r\n.chart-card:first-child {\r\n  grid-column: 1 / -1;\r\n}\r\n\r\n.chart {\r\n  height: 300px;\r\n}\r\n</style> "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}