{"ast":null,"code":"import _objectSpread from \"C:/Users/indexae/Desktop/scm/scm\\u65E5\\u5FD7/scm/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"C:/Users/indexae/Desktop/scm/scm\\u65E5\\u5FD7/scm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/indexae/Desktop/scm/scm\\u65E5\\u5FD7/scm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.parse-float.js\";\nimport \"core-js/modules/es.parse-int.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nimport \"core-js/modules/esnext.iterator.reduce.js\";\nimport { ref, reactive, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nexport default {\n  __name: 'form',\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose;\n    __expose();\n    var route = useRoute();\n    var router = useRouter();\n    var formRef = ref(null);\n    var submitting = ref(false);\n\n    // 获取路由参数\n    var id = route.query.id;\n\n    // 表单数据\n    var form = reactive({\n      returnNo: '',\n      orderId: '',\n      orderNo: '',\n      customerId: '',\n      customerName: '',\n      totalAmount: 0,\n      remark: '',\n      items: []\n    });\n\n    // 表单验证规则\n    var rules = {\n      orderId: [{\n        required: true,\n        message: '请选择关联订单',\n        trigger: 'change'\n      }],\n      handlerId: [{\n        required: true,\n        message: '请选择经办人',\n        trigger: 'change'\n      }],\n      remark: [{\n        required: true,\n        message: '请输入退货说明',\n        trigger: 'blur'\n      }],\n      items: [{\n        required: true,\n        type: 'array',\n        message: '请添加退货商品',\n        trigger: 'change'\n      }]\n    };\n\n    // 订单列表\n    var orderList = ref([]);\n    // 商品列表\n    var productList = ref([]);\n    // 经办人列表\n    var handlerList = ref([]);\n\n    // 获取订单列表\n    var getOrders = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response, result;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return fetch('/api/sale/orders?status=approved', {\n                headers: {\n                  'Accept': 'application/json'\n                },\n                credentials: 'include'\n              });\n            case 3:\n              response = _context.sent;\n              _context.next = 6;\n              return response.json();\n            case 6:\n              result = _context.sent;\n              if (result.code === 0) {\n                orderList.value = result.data.list || [];\n                // 打印订单列表数据,用于调试\n                console.log('订单列表:', orderList.value);\n              } else {\n                ElMessage.error(result.message || '获取订单列表失败');\n              }\n              _context.next = 14;\n              break;\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](0);\n              console.error('获取订单列表失败:', _context.t0);\n              ElMessage.error('获取订单列表失败');\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 10]]);\n      }));\n      return function getOrders() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    // 获取订单详情\n    var getOrderDetail = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(orderId) {\n        var response, result, order;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              console.log('获取订单详情,orderId:', orderId);\n              _context2.next = 4;\n              return fetch(\"/api/sale/orders/\".concat(orderId), {\n                headers: {\n                  'Accept': 'application/json'\n                },\n                credentials: 'include'\n              });\n            case 4:\n              response = _context2.sent;\n              _context2.next = 7;\n              return response.json();\n            case 7:\n              result = _context2.sent;\n              if (!(result.code === 0)) {\n                _context2.next = 20;\n                break;\n              }\n              order = result.data;\n              if (order) {\n                _context2.next = 13;\n                break;\n              }\n              ElMessage.error('获取订单详情失败: 订单不存在');\n              return _context2.abrupt(\"return\");\n            case 13:\n              console.log('订单原始数据:', order);\n              form.orderNo = order.orderNo;\n              form.customerId = order.customerId;\n              form.customerName = order.customerName;\n\n              // 不再覆盖productList\n              console.log('商品列表:', productList.value);\n              _context2.next = 21;\n              break;\n            case 20:\n              ElMessage.error(result.message || '获取订单详情失败');\n            case 21:\n              _context2.next = 27;\n              break;\n            case 23:\n              _context2.prev = 23;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error('获取订单详情失败:', _context2.t0);\n              ElMessage.error('获取订单详情失败');\n            case 27:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 23]]);\n      }));\n      return function getOrderDetail(_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    // 处理订单选择变化\n    var handleOrderChange = function handleOrderChange(orderId) {\n      if (orderId) {\n        getOrderDetail(orderId);\n        // 清空已选商品\n        form.items = [];\n      }\n    };\n\n    // 处理商品选择变化\n    var handleProductChange = function handleProductChange(productId, index) {\n      console.log('选择商品:', productId, '索引:', index);\n      console.log('当前商品列表:', productList.value);\n      var product = productList.value.find(function (p) {\n        return p.id === productId;\n      });\n      console.log('找到的商品:', product);\n      if (product) {\n        form.items[index] = _objectSpread(_objectSpread({}, form.items[index]), {}, {\n          productId: product.id,\n          productName: product.name,\n          spec: product.spec,\n          unit: product.unit,\n          unitPrice: product.price,\n          quantity: 1\n        });\n        calculateItemAmount(index);\n      }\n    };\n\n    // 计算商品金额\n    var calculateItemAmount = function calculateItemAmount(index) {\n      var item = form.items[index];\n      if (item.quantity && item.unitPrice) {\n        item.totalPrice = (item.quantity * item.unitPrice).toFixed(2);\n      }\n      calculateTotalAmount();\n    };\n\n    // 计算总金额\n    var calculateTotalAmount = function calculateTotalAmount() {\n      form.totalAmount = form.items.reduce(function (sum, item) {\n        return sum + (parseFloat(item.totalPrice) || 0);\n      }, 0).toFixed(2);\n    };\n\n    // 添加商品\n    var handleAddItem = function handleAddItem() {\n      form.items.push({\n        productId: '',\n        productName: '',\n        spec: '',\n        unit: '',\n        quantity: 1,\n        unitPrice: 0,\n        totalPrice: 0\n      });\n    };\n\n    // 删除商品\n    var handleDeleteItem = function handleDeleteItem(index) {\n      form.items.splice(index, 1);\n      calculateTotalAmount();\n    };\n\n    // 提交表单\n    var handleSubmit = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              if (formRef.value) {\n                _context4.next = 2;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 2:\n              _context4.next = 4;\n              return formRef.value.validate(/*#__PURE__*/function () {\n                var _ref5 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(valid) {\n                  var url, method, submitData, response, result;\n                  return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                    while (1) switch (_context3.prev = _context3.next) {\n                      case 0:\n                        if (!valid) {\n                          _context3.next = 24;\n                          break;\n                        }\n                        submitting.value = true;\n                        _context3.prev = 2;\n                        url = id ? \"/api/sale/returns/\".concat(id) : '/api/sale/returns';\n                        method = id ? 'PUT' : 'POST'; // 准备提交数据\n                        submitData = _objectSpread(_objectSpread({}, form), {}, {\n                          customerId: form.customerId,\n                          totalAmount: parseFloat(form.totalAmount),\n                          status: 'pending',\n                          // 设置初始状态\n                          items: form.items.map(function (item) {\n                            return {\n                              orderId: form.orderId,\n                              productId: item.productId,\n                              productName: item.productName,\n                              spec: item.spec,\n                              unit: item.unit,\n                              quantity: parseInt(item.quantity),\n                              unitPrice: parseFloat(item.unitPrice),\n                              totalPrice: parseFloat(item.totalPrice)\n                            };\n                          })\n                        }); // 删除returnNo字段\n                        delete submitData.returnNo;\n\n                        // 打印提交的数据用于调试\n                        console.log('提交的数据:', submitData);\n                        _context3.next = 10;\n                        return fetch(url, {\n                          method: method,\n                          headers: {\n                            'Content-Type': 'application/json',\n                            'Accept': 'application/json'\n                          },\n                          credentials: 'include',\n                          body: JSON.stringify(submitData)\n                        });\n                      case 10:\n                        response = _context3.sent;\n                        _context3.next = 13;\n                        return response.json();\n                      case 13:\n                        result = _context3.sent;\n                        if (result.code === 0) {\n                          ElMessage.success(id ? '更新成功' : '创建成功');\n                          router.back();\n                        } else {\n                          ElMessage.error(result.message || (id ? '更新失败' : '创建失败'));\n                        }\n                        _context3.next = 21;\n                        break;\n                      case 17:\n                        _context3.prev = 17;\n                        _context3.t0 = _context3[\"catch\"](2);\n                        console.error(id ? '更新退货单失败:' : '创建退货单失败:', _context3.t0);\n                        ElMessage.error(id ? '更新失败' : '创建失败');\n                      case 21:\n                        _context3.prev = 21;\n                        submitting.value = false;\n                        return _context3.finish(21);\n                      case 24:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }, _callee3, null, [[2, 17, 21, 24]]);\n                }));\n                return function (_x2) {\n                  return _ref5.apply(this, arguments);\n                };\n              }());\n            case 4:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4);\n      }));\n      return function handleSubmit() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    // 获取退货单详情\n    var getDetail = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var response, result;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return fetch(\"/api/sale/returns/\".concat(id), {\n                headers: {\n                  'Accept': 'application/json'\n                },\n                credentials: 'include'\n              });\n            case 3:\n              response = _context5.sent;\n              _context5.next = 6;\n              return response.json();\n            case 6:\n              result = _context5.sent;\n              if (!(result.code === 0)) {\n                _context5.next = 14;\n                break;\n              }\n              Object.assign(form, result.data);\n              // 获取关联订单的商品列表\n              if (!form.orderId) {\n                _context5.next = 12;\n                break;\n              }\n              _context5.next = 12;\n              return getOrderDetail(form.orderId);\n            case 12:\n              _context5.next = 15;\n              break;\n            case 14:\n              ElMessage.error(result.message || '获取退货单详情失败');\n            case 15:\n              _context5.next = 21;\n              break;\n            case 17:\n              _context5.prev = 17;\n              _context5.t0 = _context5[\"catch\"](0);\n              console.error('获取退货单详情失败:', _context5.t0);\n              ElMessage.error('获取退货单详情失败');\n            case 21:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, null, [[0, 17]]);\n      }));\n      return function getDetail() {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n\n    // 获取商品列表\n    var getProducts = /*#__PURE__*/function () {\n      var _ref7 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var response, result;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 3;\n              return fetch('/api/products', {\n                headers: {\n                  'Accept': 'application/json'\n                },\n                credentials: 'include'\n              });\n            case 3:\n              response = _context6.sent;\n              _context6.next = 6;\n              return response.json();\n            case 6:\n              result = _context6.sent;\n              if (result.code === 0) {\n                productList.value = result.data.list || [];\n                console.log('商品列表:', productList.value);\n              } else {\n                ElMessage.error(result.message || '获取商品列表失败');\n              }\n              _context6.next = 14;\n              break;\n            case 10:\n              _context6.prev = 10;\n              _context6.t0 = _context6[\"catch\"](0);\n              console.error('获取商品列表失败:', _context6.t0);\n              ElMessage.error('获取商品列表失败');\n            case 14:\n            case \"end\":\n              return _context6.stop();\n          }\n        }, _callee6, null, [[0, 10]]);\n      }));\n      return function getProducts() {\n        return _ref7.apply(this, arguments);\n      };\n    }();\n\n    // 获取经办人列表\n    var getHandlers = /*#__PURE__*/function () {\n      var _ref8 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n        var response, result;\n        return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.prev = 0;\n              _context7.next = 3;\n              return fetch('/api/handlers', {\n                headers: {\n                  'Accept': 'application/json'\n                },\n                credentials: 'include'\n              });\n            case 3:\n              response = _context7.sent;\n              _context7.next = 6;\n              return response.json();\n            case 6:\n              result = _context7.sent;\n              if (result.code === 0) {\n                handlerList.value = result.data.list || [];\n                console.log('经办人列表数据:', handlerList.value);\n              } else {\n                ElMessage.error(result.message || '获取经办人列表失败');\n              }\n              _context7.next = 14;\n              break;\n            case 10:\n              _context7.prev = 10;\n              _context7.t0 = _context7[\"catch\"](0);\n              console.error('获取经办人列表失败:', _context7.t0);\n              ElMessage.error('获取经办人列表失败');\n            case 14:\n            case \"end\":\n              return _context7.stop();\n          }\n        }, _callee7, null, [[0, 10]]);\n      }));\n      return function getHandlers() {\n        return _ref8.apply(this, arguments);\n      };\n    }();\n\n    // 处理经办人选择变化\n    var handleHandlerChange = function handleHandlerChange(handlerId) {\n      if (handlerId) {\n        var handler = handlerList.value.find(function (h) {\n          return h.id === handlerId;\n        });\n        if (handler) {\n          form.handlerName = handler.name;\n        }\n      }\n    };\n    onMounted(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n      return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n        while (1) switch (_context8.prev = _context8.next) {\n          case 0:\n            _context8.next = 2;\n            return getProducts();\n          case 2:\n            _context8.next = 4;\n            return getOrders();\n          case 4:\n            _context8.next = 6;\n            return getHandlers();\n          case 6:\n            if (!id) {\n              _context8.next = 9;\n              break;\n            }\n            _context8.next = 9;\n            return getDetail();\n          case 9:\n          case \"end\":\n            return _context8.stop();\n        }\n      }, _callee8);\n    })));\n    var __returned__ = {\n      route: route,\n      router: router,\n      formRef: formRef,\n      submitting: submitting,\n      id: id,\n      form: form,\n      rules: rules,\n      orderList: orderList,\n      productList: productList,\n      handlerList: handlerList,\n      getOrders: getOrders,\n      getOrderDetail: getOrderDetail,\n      handleOrderChange: handleOrderChange,\n      handleProductChange: handleProductChange,\n      calculateItemAmount: calculateItemAmount,\n      calculateTotalAmount: calculateTotalAmount,\n      handleAddItem: handleAddItem,\n      handleDeleteItem: handleDeleteItem,\n      handleSubmit: handleSubmit,\n      getDetail: getDetail,\n      getProducts: getProducts,\n      getHandlers: getHandlers,\n      handleHandlerChange: handleHandlerChange,\n      ref: ref,\n      reactive: reactive,\n      onMounted: onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","onMounted","useRoute","useRouter","ElMessage","route","router","formRef","submitting","id","query","form","returnNo","orderId","orderNo","customerId","customerName","totalAmount","remark","items","rules","required","message","trigger","handlerId","type","orderList","productList","handlerList","getOrders","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","result","wrap","_callee$","_context","prev","next","fetch","headers","credentials","sent","json","code","value","data","list","console","log","error","t0","stop","apply","arguments","getOrderDetail","_ref3","_callee2","order","_callee2$","_context2","concat","abrupt","_x","handleOrderChange","handleProductChange","productId","index","product","find","p","_objectSpread","productName","name","spec","unit","unitPrice","price","quantity","calculateItemAmount","item","totalPrice","toFixed","calculateTotalAmount","reduce","sum","parseFloat","handleAddItem","push","handleDeleteItem","splice","handleSubmit","_ref4","_callee4","_callee4$","_context4","validate","_ref5","_callee3","valid","url","method","submitData","_callee3$","_context3","status","map","parseInt","body","JSON","stringify","success","back","finish","_x2","getDetail","_ref6","_callee5","_callee5$","_context5","Object","assign","getProducts","_ref7","_callee6","_callee6$","_context6","getHandlers","_ref8","_callee7","_callee7$","_context7","handleHandlerChange","handler","h","handlerName","_callee8","_callee8$","_context8"],"sources":["C:/Users/indexae/Desktop/scm/scm日志/scm/frontend/src/views/sale/return/form.vue"],"sourcesContent":["<template>\r\n  <div class=\"sale-return-form\">\r\n    <div class=\"page-header\">\r\n      <h2>{{ id ? '编辑退货单' : '新增退货单' }}</h2>\r\n    </div>\r\n\r\n    <el-form ref=\"formRef\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\r\n      <el-form-item label=\"退货单号\">\r\n        <el-input v-model=\"form.returnNo\" disabled />\r\n      </el-form-item>\r\n      \r\n      <el-form-item label=\"关联订单\" prop=\"orderId\">\r\n        <el-select \r\n          v-model=\"form.orderId\" \r\n          placeholder=\"请选择关联订单\" \r\n          @change=\"handleOrderChange\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-option\r\n            v-for=\"item in orderList\"\r\n            :key=\"item.id\"\r\n            :label=\"item.orderNo\"\r\n            :value=\"item.id\"\r\n          >\r\n            <span>{{ item.orderNo }}</span>\r\n            <span style=\"float: right; color: #8492a6; font-size: 13px\">\r\n              {{ item.customerName }}\r\n            </span>\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"客户名称\">\r\n        <el-input v-model=\"form.customerName\" disabled />\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"经办人\" prop=\"handlerId\">\r\n        <el-select \r\n          v-model=\"form.handlerId\" \r\n          placeholder=\"请选择经办人\"\r\n          @change=\"handleHandlerChange\"\r\n          style=\"width: 100%\"\r\n        >\r\n          <el-option\r\n            v-for=\"item in handlerList\"\r\n            :key=\"item.id\"\r\n            :label=\"item.name\"\r\n            :value=\"item.id\"\r\n          >\r\n            <span>{{ item.name }}</span>\r\n          </el-option>\r\n        </el-select>\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"退货商品\" prop=\"items\">\r\n        <div v-for=\"(item, index) in form.items\" :key=\"index\" class=\"return-item\">\r\n          <el-select\r\n            v-model=\"item.productId\"\r\n            placeholder=\"请选择商品\"\r\n            @change=\"(val) => handleProductChange(val, index)\"\r\n            style=\"width: 200px\"\r\n          >\r\n            <el-option\r\n              v-for=\"product in productList\"\r\n              :key=\"product.id\"\r\n              :label=\"product.name\"\r\n              :value=\"product.id\"\r\n            >\r\n              <span>{{ product.name }}</span>\r\n              <span style=\"float: right; color: #8492a6; font-size: 13px\">\r\n                {{ product.spec }}\r\n              </span>\r\n            </el-option>\r\n          </el-select>\r\n          \r\n          <el-input v-model=\"item.spec\" placeholder=\"规格\" disabled style=\"width: 120px\" />\r\n          <el-input v-model=\"item.unit\" placeholder=\"单位\" disabled style=\"width: 80px\" />\r\n          \r\n          <el-input-number\r\n            v-model=\"item.quantity\"\r\n            :min=\"1\"\r\n            :max=\"item.maxQuantity\"\r\n            @change=\"() => calculateItemAmount(index)\"\r\n            style=\"width: 120px\"\r\n          />\r\n          \r\n          <el-input-number\r\n            v-model=\"item.unitPrice\"\r\n            :min=\"0\"\r\n            :precision=\"2\"\r\n            disabled\r\n            style=\"width: 120px\"\r\n          />\r\n          \r\n          <el-input\r\n            v-model=\"item.totalPrice\"\r\n            disabled\r\n            style=\"width: 120px\"\r\n          />\r\n          \r\n          <el-button type=\"danger\" @click=\"handleDeleteItem(index)\">删除</el-button>\r\n        </div>\r\n        \r\n        <el-button type=\"primary\" @click=\"handleAddItem\">添加商品</el-button>\r\n      </el-form-item>\r\n      \r\n      <el-form-item label=\"退货说明\" prop=\"remark\">\r\n        <el-input\r\n          v-model=\"form.remark\"\r\n          type=\"textarea\"\r\n          :rows=\"3\"\r\n          placeholder=\"请输入退货说明\"\r\n        />\r\n      </el-form-item>\r\n\r\n      <el-form-item label=\"总金额\">\r\n        <el-input v-model=\"form.totalAmount\" disabled />\r\n      </el-form-item>\r\n      \r\n      <el-form-item>\r\n        <el-button type=\"primary\" @click=\"handleSubmit\" :loading=\"submitting\">\r\n          {{ id ? '更新' : '提交' }}\r\n        </el-button>\r\n        <el-button @click=\"router.back()\">取消</el-button>\r\n      </el-form-item>\r\n    </el-form>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage } from 'element-plus'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst formRef = ref(null)\r\nconst submitting = ref(false)\r\n\r\n// 获取路由参数\r\nconst id = route.query.id\r\n\r\n// 表单数据\r\nconst form = reactive({\r\n  returnNo: '',\r\n  orderId: '',\r\n  orderNo: '',\r\n  customerId: '',\r\n  customerName: '',\r\n  totalAmount: 0,\r\n  remark: '',\r\n  items: []\r\n})\r\n\r\n// 表单验证规则\r\nconst rules = {\r\n  orderId: [{ required: true, message: '请选择关联订单', trigger: 'change' }],\r\n  handlerId: [{ required: true, message: '请选择经办人', trigger: 'change' }],\r\n  remark: [{ required: true, message: '请输入退货说明', trigger: 'blur' }],\r\n  items: [{ required: true, type: 'array', message: '请添加退货商品', trigger: 'change' }]\r\n}\r\n\r\n// 订单列表\r\nconst orderList = ref([])\r\n// 商品列表\r\nconst productList = ref([])\r\n// 经办人列表\r\nconst handlerList = ref([])\r\n\r\n// 获取订单列表\r\nconst getOrders = async () => {\r\n  try {\r\n    const response = await fetch('/api/sale/orders?status=approved', {\r\n      headers: {\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      orderList.value = result.data.list || []\r\n      // 打印订单列表数据,用于调试\r\n      console.log('订单列表:', orderList.value)\r\n    } else {\r\n      ElMessage.error(result.message || '获取订单列表失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取订单列表失败:', error)\r\n    ElMessage.error('获取订单列表失败')\r\n  }\r\n}\r\n\r\n// 获取订单详情\r\nconst getOrderDetail = async (orderId) => {\r\n  try {\r\n    console.log('获取订单详情,orderId:', orderId)\r\n    const response = await fetch(`/api/sale/orders/${orderId}`, {\r\n      headers: {\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      const order = result.data\r\n      if (!order) {\r\n        ElMessage.error('获取订单详情失败: 订单不存在')\r\n        return\r\n      }\r\n      \r\n      console.log('订单原始数据:', order)\r\n      \r\n      form.orderNo = order.orderNo\r\n      form.customerId = order.customerId\r\n      form.customerName = order.customerName\r\n      \r\n      // 不再覆盖productList\r\n      console.log('商品列表:', productList.value)\r\n    } else {\r\n      ElMessage.error(result.message || '获取订单详情失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取订单详情失败:', error)\r\n    ElMessage.error('获取订单详情失败')\r\n  }\r\n}\r\n\r\n// 处理订单选择变化\r\nconst handleOrderChange = (orderId) => {\r\n  if (orderId) {\r\n    getOrderDetail(orderId)\r\n    // 清空已选商品\r\n    form.items = []\r\n  }\r\n}\r\n\r\n// 处理商品选择变化\r\nconst handleProductChange = (productId, index) => {\r\n  console.log('选择商品:', productId, '索引:', index)\r\n  console.log('当前商品列表:', productList.value)\r\n  \r\n  const product = productList.value.find(p => p.id === productId)\r\n  console.log('找到的商品:', product)\r\n  \r\n  if (product) {\r\n    form.items[index] = {\r\n      ...form.items[index],\r\n      productId: product.id,\r\n      productName: product.name,\r\n      spec: product.spec,\r\n      unit: product.unit,\r\n      unitPrice: product.price,\r\n      quantity: 1\r\n    }\r\n    calculateItemAmount(index)\r\n  }\r\n}\r\n\r\n// 计算商品金额\r\nconst calculateItemAmount = (index) => {\r\n  const item = form.items[index]\r\n  if (item.quantity && item.unitPrice) {\r\n    item.totalPrice = (item.quantity * item.unitPrice).toFixed(2)\r\n  }\r\n  calculateTotalAmount()\r\n}\r\n\r\n// 计算总金额\r\nconst calculateTotalAmount = () => {\r\n  form.totalAmount = form.items.reduce((sum, item) => {\r\n    return sum + (parseFloat(item.totalPrice) || 0)\r\n  }, 0).toFixed(2)\r\n}\r\n\r\n// 添加商品\r\nconst handleAddItem = () => {\r\n  form.items.push({\r\n    productId: '',\r\n    productName: '',\r\n    spec: '',\r\n    unit: '',\r\n    quantity: 1,\r\n    unitPrice: 0,\r\n    totalPrice: 0\r\n  })\r\n}\r\n\r\n// 删除商品\r\nconst handleDeleteItem = (index) => {\r\n  form.items.splice(index, 1)\r\n  calculateTotalAmount()\r\n}\r\n\r\n// 提交表单\r\nconst handleSubmit = async () => {\r\n  if (!formRef.value) return\r\n  \r\n  await formRef.value.validate(async (valid) => {\r\n    if (valid) {\r\n      submitting.value = true\r\n      try {\r\n        const url = id ? `/api/sale/returns/${id}` : '/api/sale/returns'\r\n        const method = id ? 'PUT' : 'POST'\r\n        \r\n        // 准备提交数据\r\n        const submitData = {\r\n          ...form,\r\n          customerId: form.customerId,\r\n          totalAmount: parseFloat(form.totalAmount),\r\n          status: 'pending', // 设置初始状态\r\n          items: form.items.map(item => ({\r\n            orderId: form.orderId,\r\n            productId: item.productId,\r\n            productName: item.productName,\r\n            spec: item.spec,\r\n            unit: item.unit,\r\n            quantity: parseInt(item.quantity),\r\n            unitPrice: parseFloat(item.unitPrice),\r\n            totalPrice: parseFloat(item.totalPrice)\r\n          }))\r\n        }\r\n        \r\n        // 删除returnNo字段\r\n        delete submitData.returnNo\r\n        \r\n        // 打印提交的数据用于调试\r\n        console.log('提交的数据:', submitData)\r\n        \r\n        const response = await fetch(url, {\r\n          method,\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n          },\r\n          credentials: 'include',\r\n          body: JSON.stringify(submitData)\r\n        })\r\n        \r\n        const result = await response.json()\r\n        if (result.code === 0) {\r\n          ElMessage.success(id ? '更新成功' : '创建成功')\r\n          router.back()\r\n        } else {\r\n          ElMessage.error(result.message || (id ? '更新失败' : '创建失败'))\r\n        }\r\n      } catch (error) {\r\n        console.error(id ? '更新退货单失败:' : '创建退货单失败:', error)\r\n        ElMessage.error(id ? '更新失败' : '创建失败')\r\n      } finally {\r\n        submitting.value = false\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n// 获取退货单详情\r\nconst getDetail = async () => {\r\n  try {\r\n    const response = await fetch(`/api/sale/returns/${id}`, {\r\n      headers: {\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      Object.assign(form, result.data)\r\n      // 获取关联订单的商品列表\r\n      if (form.orderId) {\r\n        await getOrderDetail(form.orderId)\r\n      }\r\n    } else {\r\n      ElMessage.error(result.message || '获取退货单详情失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取退货单详情失败:', error)\r\n    ElMessage.error('获取退货单详情失败')\r\n  }\r\n}\r\n\r\n// 获取商品列表\r\nconst getProducts = async () => {\r\n  try {\r\n    const response = await fetch('/api/products', {\r\n      headers: {\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      productList.value = result.data.list || []\r\n      console.log('商品列表:', productList.value)\r\n    } else {\r\n      ElMessage.error(result.message || '获取商品列表失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取商品列表失败:', error)\r\n    ElMessage.error('获取商品列表失败')\r\n  }\r\n}\r\n\r\n// 获取经办人列表\r\nconst getHandlers = async () => {\r\n  try {\r\n    const response = await fetch('/api/handlers', {\r\n      headers: {\r\n        'Accept': 'application/json'\r\n      },\r\n      credentials: 'include'\r\n    })\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      handlerList.value = result.data.list || []\r\n      console.log('经办人列表数据:', handlerList.value)\r\n    } else {\r\n      ElMessage.error(result.message || '获取经办人列表失败')\r\n    }\r\n  } catch (error) {\r\n    console.error('获取经办人列表失败:', error)\r\n    ElMessage.error('获取经办人列表失败')\r\n  }\r\n}\r\n\r\n// 处理经办人选择变化\r\nconst handleHandlerChange = (handlerId) => {\r\n  if (handlerId) {\r\n    const handler = handlerList.value.find(h => h.id === handlerId)\r\n    if (handler) {\r\n      form.handlerName = handler.name\r\n    }\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  // 获取商品列表\r\n  await getProducts()\r\n  // 获取订单列表\r\n  await getOrders()\r\n  // 获取经办人列表\r\n  await getHandlers()\r\n  \r\n  // 如果是编辑模式，获取退货单详情\r\n  if (id) {\r\n    await getDetail()\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.sale-return-form {\r\n  padding: 20px;\r\n}\r\n\r\n.page-header {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.return-item {\r\n  display: flex;\r\n  gap: 10px;\r\n  margin-bottom: 10px;\r\n  align-items: center;\r\n}\r\n</style> "],"mappings":";;;;;;;;;;;;;;;;;;;;AAkIA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AAC9C,SAASC,QAAQ,EAAEC,SAAS,QAAQ,YAAY;AAChD,SAASC,SAAS,QAAQ,cAAc;;;;;;IAExC,IAAMC,KAAK,GAAGH,QAAQ,CAAC,CAAC;IACxB,IAAMI,MAAM,GAAGH,SAAS,CAAC,CAAC;IAC1B,IAAMI,OAAO,GAAGR,GAAG,CAAC,IAAI,CAAC;IACzB,IAAMS,UAAU,GAAGT,GAAG,CAAC,KAAK,CAAC;;IAE7B;IACA,IAAMU,EAAE,GAAGJ,KAAK,CAACK,KAAK,CAACD,EAAE;;IAEzB;IACA,IAAME,IAAI,GAAGX,QAAQ,CAAC;MACpBY,QAAQ,EAAE,EAAE;MACZC,OAAO,EAAE,EAAE;MACXC,OAAO,EAAE,EAAE;MACXC,UAAU,EAAE,EAAE;MACdC,YAAY,EAAE,EAAE;MAChBC,WAAW,EAAE,CAAC;MACdC,MAAM,EAAE,EAAE;MACVC,KAAK,EAAE;IACT,CAAC,CAAC;;IAEF;IACA,IAAMC,KAAK,GAAG;MACZP,OAAO,EAAE,CAAC;QAAEQ,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,SAAS;QAAEC,OAAO,EAAE;MAAS,CAAC,CAAC;MACpEC,SAAS,EAAE,CAAC;QAAEH,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,QAAQ;QAAEC,OAAO,EAAE;MAAS,CAAC,CAAC;MACrEL,MAAM,EAAE,CAAC;QAAEG,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,SAAS;QAAEC,OAAO,EAAE;MAAO,CAAC,CAAC;MACjEJ,KAAK,EAAE,CAAC;QAAEE,QAAQ,EAAE,IAAI;QAAEI,IAAI,EAAE,OAAO;QAAEH,OAAO,EAAE,SAAS;QAAEC,OAAO,EAAE;MAAS,CAAC;IAClF,CAAC;;IAED;IACA,IAAMG,SAAS,GAAG3B,GAAG,CAAC,EAAE,CAAC;IACzB;IACA,IAAM4B,WAAW,GAAG5B,GAAG,CAAC,EAAE,CAAC;IAC3B;IACA,IAAM6B,WAAW,GAAG7B,GAAG,CAAC,EAAE,CAAC;;IAE3B;IACA,IAAM8B,SAAS;MAAA,IAAAC,KAAA,GAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA;QAAA,IAAAC,QAAA,EAAAC,MAAA;QAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAESC,KAAK,CAAC,kCAAkC,EAAE;gBAC/DC,OAAO,EAAE;kBACP,QAAQ,EAAE;gBACZ,CAAC;gBACDC,WAAW,EAAE;cACf,CAAC,CAAC;YAAA;cALIT,QAAQ,GAAAI,QAAA,CAAAM,IAAA;cAAAN,QAAA,CAAAE,IAAA;cAAA,OAMON,QAAQ,CAACW,IAAI,CAAC,CAAC;YAAA;cAA9BV,MAAM,GAAAG,QAAA,CAAAM,IAAA;cACZ,IAAIT,MAAM,CAACW,IAAI,KAAK,CAAC,EAAE;gBACrBrB,SAAS,CAACsB,KAAK,GAAGZ,MAAM,CAACa,IAAI,CAACC,IAAI,IAAI,EAAE;gBACxC;gBACAC,OAAO,CAACC,GAAG,CAAC,OAAO,EAAE1B,SAAS,CAACsB,KAAK,CAAC;cACvC,CAAC,MAAM;gBACL5C,SAAS,CAACiD,KAAK,CAACjB,MAAM,CAACd,OAAO,IAAI,UAAU,CAAC;cAC/C;cAACiB,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAe,EAAA,GAAAf,QAAA;cAEDY,OAAO,CAACE,KAAK,CAAC,WAAW,EAAAd,QAAA,CAAAe,EAAO,CAAC;cACjClD,SAAS,CAACiD,KAAK,CAAC,UAAU,CAAC;YAAA;YAAA;cAAA,OAAAd,QAAA,CAAAgB,IAAA;UAAA;QAAA,GAAArB,OAAA;MAAA,CAE9B;MAAA,gBApBKL,SAASA,CAAA;QAAA,OAAAC,KAAA,CAAA0B,KAAA,OAAAC,SAAA;MAAA;IAAA,GAoBd;;IAED;IACA,IAAMC,cAAc;MAAA,IAAAC,KAAA,GAAA5B,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA2B,SAAO/C,OAAO;QAAA,IAAAsB,QAAA,EAAAC,MAAA,EAAAyB,KAAA;QAAA,OAAA7B,mBAAA,GAAAK,IAAA,UAAAyB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAvB,IAAA,GAAAuB,SAAA,CAAAtB,IAAA;YAAA;cAAAsB,SAAA,CAAAvB,IAAA;cAEjCW,OAAO,CAACC,GAAG,CAAC,iBAAiB,EAAEvC,OAAO,CAAC;cAAAkD,SAAA,CAAAtB,IAAA;cAAA,OAChBC,KAAK,qBAAAsB,MAAA,CAAqBnD,OAAO,GAAI;gBAC1D8B,OAAO,EAAE;kBACP,QAAQ,EAAE;gBACZ,CAAC;gBACDC,WAAW,EAAE;cACf,CAAC,CAAC;YAAA;cALIT,QAAQ,GAAA4B,SAAA,CAAAlB,IAAA;cAAAkB,SAAA,CAAAtB,IAAA;cAAA,OAMON,QAAQ,CAACW,IAAI,CAAC,CAAC;YAAA;cAA9BV,MAAM,GAAA2B,SAAA,CAAAlB,IAAA;cAAA,MACRT,MAAM,CAACW,IAAI,KAAK,CAAC;gBAAAgB,SAAA,CAAAtB,IAAA;gBAAA;cAAA;cACboB,KAAK,GAAGzB,MAAM,CAACa,IAAI;cAAA,IACpBY,KAAK;gBAAAE,SAAA,CAAAtB,IAAA;gBAAA;cAAA;cACRrC,SAAS,CAACiD,KAAK,CAAC,iBAAiB,CAAC;cAAA,OAAAU,SAAA,CAAAE,MAAA;YAAA;cAIpCd,OAAO,CAACC,GAAG,CAAC,SAAS,EAAES,KAAK,CAAC;cAE7BlD,IAAI,CAACG,OAAO,GAAG+C,KAAK,CAAC/C,OAAO;cAC5BH,IAAI,CAACI,UAAU,GAAG8C,KAAK,CAAC9C,UAAU;cAClCJ,IAAI,CAACK,YAAY,GAAG6C,KAAK,CAAC7C,YAAY;;cAEtC;cACAmC,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEzB,WAAW,CAACqB,KAAK,CAAC;cAAAe,SAAA,CAAAtB,IAAA;cAAA;YAAA;cAEvCrC,SAAS,CAACiD,KAAK,CAACjB,MAAM,CAACd,OAAO,IAAI,UAAU,CAAC;YAAA;cAAAyC,SAAA,CAAAtB,IAAA;cAAA;YAAA;cAAAsB,SAAA,CAAAvB,IAAA;cAAAuB,SAAA,CAAAT,EAAA,GAAAS,SAAA;cAG/CZ,OAAO,CAACE,KAAK,CAAC,WAAW,EAAAU,SAAA,CAAAT,EAAO,CAAC;cACjClD,SAAS,CAACiD,KAAK,CAAC,UAAU,CAAC;YAAA;YAAA;cAAA,OAAAU,SAAA,CAAAR,IAAA;UAAA;QAAA,GAAAK,QAAA;MAAA,CAE9B;MAAA,gBAhCKF,cAAcA,CAAAQ,EAAA;QAAA,OAAAP,KAAA,CAAAH,KAAA,OAAAC,SAAA;MAAA;IAAA,GAgCnB;;IAED;IACA,IAAMU,iBAAiB,GAAG,SAApBA,iBAAiBA,CAAItD,OAAO,EAAK;MACrC,IAAIA,OAAO,EAAE;QACX6C,cAAc,CAAC7C,OAAO,CAAC;QACvB;QACAF,IAAI,CAACQ,KAAK,GAAG,EAAE;MACjB;IACF,CAAC;;IAED;IACA,IAAMiD,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAAIC,SAAS,EAAEC,KAAK,EAAK;MAChDnB,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEiB,SAAS,EAAE,KAAK,EAAEC,KAAK,CAAC;MAC7CnB,OAAO,CAACC,GAAG,CAAC,SAAS,EAAEzB,WAAW,CAACqB,KAAK,CAAC;MAEzC,IAAMuB,OAAO,GAAG5C,WAAW,CAACqB,KAAK,CAACwB,IAAI,CAAC,UAAAC,CAAC;QAAA,OAAIA,CAAC,CAAChE,EAAE,KAAK4D,SAAS;MAAA,EAAC;MAC/DlB,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEmB,OAAO,CAAC;MAE9B,IAAIA,OAAO,EAAE;QACX5D,IAAI,CAACQ,KAAK,CAACmD,KAAK,CAAC,GAAAI,aAAA,CAAAA,aAAA,KACZ/D,IAAI,CAACQ,KAAK,CAACmD,KAAK,CAAC;UACpBD,SAAS,EAAEE,OAAO,CAAC9D,EAAE;UACrBkE,WAAW,EAAEJ,OAAO,CAACK,IAAI;UACzBC,IAAI,EAAEN,OAAO,CAACM,IAAI;UAClBC,IAAI,EAAEP,OAAO,CAACO,IAAI;UAClBC,SAAS,EAAER,OAAO,CAACS,KAAK;UACxBC,QAAQ,EAAE;QAAC,EACZ;QACDC,mBAAmB,CAACZ,KAAK,CAAC;MAC5B;IACF,CAAC;;IAED;IACA,IAAMY,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAAIZ,KAAK,EAAK;MACrC,IAAMa,IAAI,GAAGxE,IAAI,CAACQ,KAAK,CAACmD,KAAK,CAAC;MAC9B,IAAIa,IAAI,CAACF,QAAQ,IAAIE,IAAI,CAACJ,SAAS,EAAE;QACnCI,IAAI,CAACC,UAAU,GAAG,CAACD,IAAI,CAACF,QAAQ,GAAGE,IAAI,CAACJ,SAAS,EAAEM,OAAO,CAAC,CAAC,CAAC;MAC/D;MACAC,oBAAoB,CAAC,CAAC;IACxB,CAAC;;IAED;IACA,IAAMA,oBAAoB,GAAG,SAAvBA,oBAAoBA,CAAA,EAAS;MACjC3E,IAAI,CAACM,WAAW,GAAGN,IAAI,CAACQ,KAAK,CAACoE,MAAM,CAAC,UAACC,GAAG,EAAEL,IAAI,EAAK;QAClD,OAAOK,GAAG,IAAIC,UAAU,CAACN,IAAI,CAACC,UAAU,CAAC,IAAI,CAAC,CAAC;MACjD,CAAC,EAAE,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC,CAAC;IAClB,CAAC;;IAED;IACA,IAAMK,aAAa,GAAG,SAAhBA,aAAaA,CAAA,EAAS;MAC1B/E,IAAI,CAACQ,KAAK,CAACwE,IAAI,CAAC;QACdtB,SAAS,EAAE,EAAE;QACbM,WAAW,EAAE,EAAE;QACfE,IAAI,EAAE,EAAE;QACRC,IAAI,EAAE,EAAE;QACRG,QAAQ,EAAE,CAAC;QACXF,SAAS,EAAE,CAAC;QACZK,UAAU,EAAE;MACd,CAAC,CAAC;IACJ,CAAC;;IAED;IACA,IAAMQ,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAItB,KAAK,EAAK;MAClC3D,IAAI,CAACQ,KAAK,CAAC0E,MAAM,CAACvB,KAAK,EAAE,CAAC,CAAC;MAC3BgB,oBAAoB,CAAC,CAAC;IACxB,CAAC;;IAED;IACA,IAAMQ,YAAY;MAAA,IAAAC,KAAA,GAAAhE,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA+D,SAAA;QAAA,OAAAhE,mBAAA,GAAAK,IAAA,UAAA4D,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAA1D,IAAA,GAAA0D,SAAA,CAAAzD,IAAA;YAAA;cAAA,IACdlC,OAAO,CAACyC,KAAK;gBAAAkD,SAAA,CAAAzD,IAAA;gBAAA;cAAA;cAAA,OAAAyD,SAAA,CAAAjC,MAAA;YAAA;cAAAiC,SAAA,CAAAzD,IAAA;cAAA,OAEZlC,OAAO,CAACyC,KAAK,CAACmD,QAAQ;gBAAA,IAAAC,KAAA,GAAArE,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAoE,SAAOC,KAAK;kBAAA,IAAAC,GAAA,EAAAC,MAAA,EAAAC,UAAA,EAAAtE,QAAA,EAAAC,MAAA;kBAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAqE,UAAAC,SAAA;oBAAA,kBAAAA,SAAA,CAAAnE,IAAA,GAAAmE,SAAA,CAAAlE,IAAA;sBAAA;wBAAA,KACnC6D,KAAK;0BAAAK,SAAA,CAAAlE,IAAA;0BAAA;wBAAA;wBACPjC,UAAU,CAACwC,KAAK,GAAG,IAAI;wBAAA2D,SAAA,CAAAnE,IAAA;wBAEf+D,GAAG,GAAG9F,EAAE,wBAAAuD,MAAA,CAAwBvD,EAAE,IAAK,mBAAmB;wBAC1D+F,MAAM,GAAG/F,EAAE,GAAG,KAAK,GAAG,MAAM,EAElC;wBACMgG,UAAU,GAAA/B,aAAA,CAAAA,aAAA,KACX/D,IAAI;0BACPI,UAAU,EAAEJ,IAAI,CAACI,UAAU;0BAC3BE,WAAW,EAAEwE,UAAU,CAAC9E,IAAI,CAACM,WAAW,CAAC;0BACzC2F,MAAM,EAAE,SAAS;0BAAE;0BACnBzF,KAAK,EAAER,IAAI,CAACQ,KAAK,CAAC0F,GAAG,CAAC,UAAA1B,IAAI;4BAAA,OAAK;8BAC7BtE,OAAO,EAAEF,IAAI,CAACE,OAAO;8BACrBwD,SAAS,EAAEc,IAAI,CAACd,SAAS;8BACzBM,WAAW,EAAEQ,IAAI,CAACR,WAAW;8BAC7BE,IAAI,EAAEM,IAAI,CAACN,IAAI;8BACfC,IAAI,EAAEK,IAAI,CAACL,IAAI;8BACfG,QAAQ,EAAE6B,QAAQ,CAAC3B,IAAI,CAACF,QAAQ,CAAC;8BACjCF,SAAS,EAAEU,UAAU,CAACN,IAAI,CAACJ,SAAS,CAAC;8BACrCK,UAAU,EAAEK,UAAU,CAACN,IAAI,CAACC,UAAU;4BACxC,CAAC;0BAAA,CAAC;wBAAC,IAGL;wBACA,OAAOqB,UAAU,CAAC7F,QAAQ;;wBAE1B;wBACAuC,OAAO,CAACC,GAAG,CAAC,QAAQ,EAAEqD,UAAU,CAAC;wBAAAE,SAAA,CAAAlE,IAAA;wBAAA,OAEVC,KAAK,CAAC6D,GAAG,EAAE;0BAChCC,MAAM,EAANA,MAAM;0BACN7D,OAAO,EAAE;4BACP,cAAc,EAAE,kBAAkB;4BAClC,QAAQ,EAAE;0BACZ,CAAC;0BACDC,WAAW,EAAE,SAAS;0BACtBmE,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACR,UAAU;wBACjC,CAAC,CAAC;sBAAA;wBARItE,QAAQ,GAAAwE,SAAA,CAAA9D,IAAA;wBAAA8D,SAAA,CAAAlE,IAAA;wBAAA,OAUON,QAAQ,CAACW,IAAI,CAAC,CAAC;sBAAA;wBAA9BV,MAAM,GAAAuE,SAAA,CAAA9D,IAAA;wBACZ,IAAIT,MAAM,CAACW,IAAI,KAAK,CAAC,EAAE;0BACrB3C,SAAS,CAAC8G,OAAO,CAACzG,EAAE,GAAG,MAAM,GAAG,MAAM,CAAC;0BACvCH,MAAM,CAAC6G,IAAI,CAAC,CAAC;wBACf,CAAC,MAAM;0BACL/G,SAAS,CAACiD,KAAK,CAACjB,MAAM,CAACd,OAAO,KAAKb,EAAE,GAAG,MAAM,GAAG,MAAM,CAAC,CAAC;wBAC3D;wBAACkG,SAAA,CAAAlE,IAAA;wBAAA;sBAAA;wBAAAkE,SAAA,CAAAnE,IAAA;wBAAAmE,SAAA,CAAArD,EAAA,GAAAqD,SAAA;wBAEDxD,OAAO,CAACE,KAAK,CAAC5C,EAAE,GAAG,UAAU,GAAG,UAAU,EAAAkG,SAAA,CAAArD,EAAO,CAAC;wBAClDlD,SAAS,CAACiD,KAAK,CAAC5C,EAAE,GAAG,MAAM,GAAG,MAAM,CAAC;sBAAA;wBAAAkG,SAAA,CAAAnE,IAAA;wBAErChC,UAAU,CAACwC,KAAK,GAAG,KAAK;wBAAA,OAAA2D,SAAA,CAAAS,MAAA;sBAAA;sBAAA;wBAAA,OAAAT,SAAA,CAAApD,IAAA;oBAAA;kBAAA,GAAA8C,QAAA;gBAAA,CAG7B;gBAAA,iBAAAgB,GAAA;kBAAA,OAAAjB,KAAA,CAAA5C,KAAA,OAAAC,SAAA;gBAAA;cAAA,IAAC;YAAA;YAAA;cAAA,OAAAyC,SAAA,CAAA3C,IAAA;UAAA;QAAA,GAAAyC,QAAA;MAAA,CACH;MAAA,gBA3DKF,YAAYA,CAAA;QAAA,OAAAC,KAAA,CAAAvC,KAAA,OAAAC,SAAA;MAAA;IAAA,GA2DjB;;IAED;IACA,IAAM6D,SAAS;MAAA,IAAAC,KAAA,GAAAxF,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAuF,SAAA;QAAA,IAAArF,QAAA,EAAAC,MAAA;QAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAoF,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAlF,IAAA,GAAAkF,SAAA,CAAAjF,IAAA;YAAA;cAAAiF,SAAA,CAAAlF,IAAA;cAAAkF,SAAA,CAAAjF,IAAA;cAAA,OAESC,KAAK,sBAAAsB,MAAA,CAAsBvD,EAAE,GAAI;gBACtDkC,OAAO,EAAE;kBACP,QAAQ,EAAE;gBACZ,CAAC;gBACDC,WAAW,EAAE;cACf,CAAC,CAAC;YAAA;cALIT,QAAQ,GAAAuF,SAAA,CAAA7E,IAAA;cAAA6E,SAAA,CAAAjF,IAAA;cAAA,OAMON,QAAQ,CAACW,IAAI,CAAC,CAAC;YAAA;cAA9BV,MAAM,GAAAsF,SAAA,CAAA7E,IAAA;cAAA,MACRT,MAAM,CAACW,IAAI,KAAK,CAAC;gBAAA2E,SAAA,CAAAjF,IAAA;gBAAA;cAAA;cACnBkF,MAAM,CAACC,MAAM,CAACjH,IAAI,EAAEyB,MAAM,CAACa,IAAI,CAAC;cAChC;cAAA,KACItC,IAAI,CAACE,OAAO;gBAAA6G,SAAA,CAAAjF,IAAA;gBAAA;cAAA;cAAAiF,SAAA,CAAAjF,IAAA;cAAA,OACRiB,cAAc,CAAC/C,IAAI,CAACE,OAAO,CAAC;YAAA;cAAA6G,SAAA,CAAAjF,IAAA;cAAA;YAAA;cAGpCrC,SAAS,CAACiD,KAAK,CAACjB,MAAM,CAACd,OAAO,IAAI,WAAW,CAAC;YAAA;cAAAoG,SAAA,CAAAjF,IAAA;cAAA;YAAA;cAAAiF,SAAA,CAAAlF,IAAA;cAAAkF,SAAA,CAAApE,EAAA,GAAAoE,SAAA;cAGhDvE,OAAO,CAACE,KAAK,CAAC,YAAY,EAAAqE,SAAA,CAAApE,EAAO,CAAC;cAClClD,SAAS,CAACiD,KAAK,CAAC,WAAW,CAAC;YAAA;YAAA;cAAA,OAAAqE,SAAA,CAAAnE,IAAA;UAAA;QAAA,GAAAiE,QAAA;MAAA,CAE/B;MAAA,gBAtBKF,SAASA,CAAA;QAAA,OAAAC,KAAA,CAAA/D,KAAA,OAAAC,SAAA;MAAA;IAAA,GAsBd;;IAED;IACA,IAAMoE,WAAW;MAAA,IAAAC,KAAA,GAAA/F,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA8F,SAAA;QAAA,IAAA5F,QAAA,EAAAC,MAAA;QAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAA2F,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAzF,IAAA,GAAAyF,SAAA,CAAAxF,IAAA;YAAA;cAAAwF,SAAA,CAAAzF,IAAA;cAAAyF,SAAA,CAAAxF,IAAA;cAAA,OAEOC,KAAK,CAAC,eAAe,EAAE;gBAC5CC,OAAO,EAAE;kBACP,QAAQ,EAAE;gBACZ,CAAC;gBACDC,WAAW,EAAE;cACf,CAAC,CAAC;YAAA;cALIT,QAAQ,GAAA8F,SAAA,CAAApF,IAAA;cAAAoF,SAAA,CAAAxF,IAAA;cAAA,OAMON,QAAQ,CAACW,IAAI,CAAC,CAAC;YAAA;cAA9BV,MAAM,GAAA6F,SAAA,CAAApF,IAAA;cACZ,IAAIT,MAAM,CAACW,IAAI,KAAK,CAAC,EAAE;gBACrBpB,WAAW,CAACqB,KAAK,GAAGZ,MAAM,CAACa,IAAI,CAACC,IAAI,IAAI,EAAE;gBAC1CC,OAAO,CAACC,GAAG,CAAC,OAAO,EAAEzB,WAAW,CAACqB,KAAK,CAAC;cACzC,CAAC,MAAM;gBACL5C,SAAS,CAACiD,KAAK,CAACjB,MAAM,CAACd,OAAO,IAAI,UAAU,CAAC;cAC/C;cAAC2G,SAAA,CAAAxF,IAAA;cAAA;YAAA;cAAAwF,SAAA,CAAAzF,IAAA;cAAAyF,SAAA,CAAA3E,EAAA,GAAA2E,SAAA;cAED9E,OAAO,CAACE,KAAK,CAAC,WAAW,EAAA4E,SAAA,CAAA3E,EAAO,CAAC;cACjClD,SAAS,CAACiD,KAAK,CAAC,UAAU,CAAC;YAAA;YAAA;cAAA,OAAA4E,SAAA,CAAA1E,IAAA;UAAA;QAAA,GAAAwE,QAAA;MAAA,CAE9B;MAAA,gBAnBKF,WAAWA,CAAA;QAAA,OAAAC,KAAA,CAAAtE,KAAA,OAAAC,SAAA;MAAA;IAAA,GAmBhB;;IAED;IACA,IAAMyE,WAAW;MAAA,IAAAC,KAAA,GAAApG,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAmG,SAAA;QAAA,IAAAjG,QAAA,EAAAC,MAAA;QAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAgG,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAA9F,IAAA,GAAA8F,SAAA,CAAA7F,IAAA;YAAA;cAAA6F,SAAA,CAAA9F,IAAA;cAAA8F,SAAA,CAAA7F,IAAA;cAAA,OAEOC,KAAK,CAAC,eAAe,EAAE;gBAC5CC,OAAO,EAAE;kBACP,QAAQ,EAAE;gBACZ,CAAC;gBACDC,WAAW,EAAE;cACf,CAAC,CAAC;YAAA;cALIT,QAAQ,GAAAmG,SAAA,CAAAzF,IAAA;cAAAyF,SAAA,CAAA7F,IAAA;cAAA,OAMON,QAAQ,CAACW,IAAI,CAAC,CAAC;YAAA;cAA9BV,MAAM,GAAAkG,SAAA,CAAAzF,IAAA;cACZ,IAAIT,MAAM,CAACW,IAAI,KAAK,CAAC,EAAE;gBACrBnB,WAAW,CAACoB,KAAK,GAAGZ,MAAM,CAACa,IAAI,CAACC,IAAI,IAAI,EAAE;gBAC1CC,OAAO,CAACC,GAAG,CAAC,UAAU,EAAExB,WAAW,CAACoB,KAAK,CAAC;cAC5C,CAAC,MAAM;gBACL5C,SAAS,CAACiD,KAAK,CAACjB,MAAM,CAACd,OAAO,IAAI,WAAW,CAAC;cAChD;cAACgH,SAAA,CAAA7F,IAAA;cAAA;YAAA;cAAA6F,SAAA,CAAA9F,IAAA;cAAA8F,SAAA,CAAAhF,EAAA,GAAAgF,SAAA;cAEDnF,OAAO,CAACE,KAAK,CAAC,YAAY,EAAAiF,SAAA,CAAAhF,EAAO,CAAC;cAClClD,SAAS,CAACiD,KAAK,CAAC,WAAW,CAAC;YAAA;YAAA;cAAA,OAAAiF,SAAA,CAAA/E,IAAA;UAAA;QAAA,GAAA6E,QAAA;MAAA,CAE/B;MAAA,gBAnBKF,WAAWA,CAAA;QAAA,OAAAC,KAAA,CAAA3E,KAAA,OAAAC,SAAA;MAAA;IAAA,GAmBhB;;IAED;IACA,IAAM8E,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAAI/G,SAAS,EAAK;MACzC,IAAIA,SAAS,EAAE;QACb,IAAMgH,OAAO,GAAG5G,WAAW,CAACoB,KAAK,CAACwB,IAAI,CAAC,UAAAiE,CAAC;UAAA,OAAIA,CAAC,CAAChI,EAAE,KAAKe,SAAS;QAAA,EAAC;QAC/D,IAAIgH,OAAO,EAAE;UACX7H,IAAI,CAAC+H,WAAW,GAAGF,OAAO,CAAC5D,IAAI;QACjC;MACF;IACF,CAAC;IAED3E,SAAS,cAAA8B,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAA0G,SAAA;MAAA,OAAA3G,mBAAA,GAAAK,IAAA,UAAAuG,UAAAC,SAAA;QAAA,kBAAAA,SAAA,CAAArG,IAAA,GAAAqG,SAAA,CAAApG,IAAA;UAAA;YAAAoG,SAAA,CAAApG,IAAA;YAAA,OAEFoF,WAAW,CAAC,CAAC;UAAA;YAAAgB,SAAA,CAAApG,IAAA;YAAA,OAEbZ,SAAS,CAAC,CAAC;UAAA;YAAAgH,SAAA,CAAApG,IAAA;YAAA,OAEXyF,WAAW,CAAC,CAAC;UAAA;YAAA,KAGfzH,EAAE;cAAAoI,SAAA,CAAApG,IAAA;cAAA;YAAA;YAAAoG,SAAA,CAAApG,IAAA;YAAA,OACE6E,SAAS,CAAC,CAAC;UAAA;UAAA;YAAA,OAAAuB,SAAA,CAAAtF,IAAA;QAAA;MAAA,GAAAoF,QAAA;IAAA,CAEpB,GAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}