{"ast":null,"code":"import _objectSpread from \"C:/Users/indexae/Desktop/scm\\u65E5\\u5FD7/scm/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport _regeneratorRuntime from \"C:/Users/indexae/Desktop/scm\\u65E5\\u5FD7/scm/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Users/indexae/Desktop/scm\\u65E5\\u5FD7/scm/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.number.constructor.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.define-property.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.find.js\";\nimport \"core-js/modules/esnext.iterator.reduce.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { ref, reactive, computed, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nimport { Delete } from '@element-plus/icons-vue';\nexport default {\n  __name: 'form',\n  setup: function setup(__props, _ref) {\n    var __expose = _ref.expose;\n    __expose();\n    var route = useRoute();\n    var router = useRouter();\n    var formRef = ref(null);\n\n    // 是否为编辑模式\n    var isEdit = computed(function () {\n      return route.query.id !== undefined;\n    });\n\n    // 表单数据\n    var form = reactive({\n      dealerId: '',\n      dealer: '',\n      remark: '',\n      items: []\n    });\n\n    // 表单验证规则\n    var rules = {\n      dealerId: [{\n        required: true,\n        message: '请选择经销商',\n        trigger: 'change'\n      }]\n    };\n\n    // 经销商列表\n    var dealers = ref([]);\n    // 商品列表\n    var products = ref([]);\n\n    // 获取经销商列表\n    var getDealers = /*#__PURE__*/function () {\n      var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var response, result;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return fetch('/api/dealers');\n            case 3:\n              response = _context.sent;\n              _context.next = 6;\n              return response.json();\n            case 6:\n              result = _context.sent;\n              if (result.code === 0) {\n                dealers.value = result.data;\n              }\n              _context.next = 13;\n              break;\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](0);\n              console.error('获取经销商列表失败:', _context.t0);\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 10]]);\n      }));\n      return function getDealers() {\n        return _ref2.apply(this, arguments);\n      };\n    }();\n\n    // 获取商品列表\n    var getProducts = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        var params, response, result;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              params = new URLSearchParams({\n                pageNum: '1',\n                pageSize: '1000' // 获取足够多的商品以供选择\n              });\n              _context2.next = 4;\n              return fetch(\"/api/products?\".concat(params.toString()));\n            case 4:\n              response = _context2.sent;\n              _context2.next = 7;\n              return response.json();\n            case 7:\n              result = _context2.sent;\n              if (result.code === 0) {\n                products.value = result.data.list || [];\n              }\n              _context2.next = 14;\n              break;\n            case 11:\n              _context2.prev = 11;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error('获取商品列表失败:', _context2.t0);\n            case 14:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 11]]);\n      }));\n      return function getProducts() {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    // 处理经销商选择变化\n    var handleDealerChange = function handleDealerChange(dealerId) {\n      var dealer = dealers.value.find(function (item) {\n        return item.id === dealerId;\n      });\n      if (dealer) {\n        form.dealer = dealer.name;\n      }\n    };\n\n    // 处理商品选择变化\n    var handleProductChange = function handleProductChange(productId, index) {\n      var product = products.value.find(function (item) {\n        return item.id === productId;\n      });\n      if (product) {\n        form.items[index] = _objectSpread(_objectSpread({}, form.items[index]), {}, {\n          productName: product.name,\n          productSpec: product.spec,\n          unit: product.unit,\n          price: product.price\n        });\n        calculateItemAmount(index);\n      }\n    };\n\n    // 添加商品明细\n    var handleAddItem = function handleAddItem() {\n      form.items.push({\n        productId: '',\n        productName: '',\n        productSpec: '',\n        unit: '',\n        quantity: 1,\n        price: 0,\n        amount: 0\n      });\n    };\n\n    // 删除商品明细\n    var handleDeleteItem = function handleDeleteItem(index) {\n      form.items.splice(index, 1);\n    };\n\n    // 计算商品金额\n    var calculateItemAmount = function calculateItemAmount(index) {\n      var item = form.items[index];\n      item.amount = item.quantity * item.price;\n    };\n\n    // 格式化金额\n    var formatAmount = function formatAmount(amount) {\n      if (!amount) return '0.00';\n      return Number(amount).toFixed(2);\n    };\n\n    // 计算总金额\n    var totalAmount = computed(function () {\n      return form.items.reduce(function (sum, item) {\n        return sum + (item.amount || 0);\n      }, 0);\n    });\n\n    // 提交表单\n    var handleSubmit = /*#__PURE__*/function () {\n      var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              if (formRef.value) {\n                _context4.next = 2;\n                break;\n              }\n              return _context4.abrupt(\"return\");\n            case 2:\n              _context4.next = 4;\n              return formRef.value.validate(/*#__PURE__*/function () {\n                var _ref5 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee3(valid) {\n                  var timestamp, code, url, method, response, result;\n                  return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n                    while (1) switch (_context3.prev = _context3.next) {\n                      case 0:\n                        if (!valid) {\n                          _context3.next = 22;\n                          break;\n                        }\n                        if (!(form.items.length === 0)) {\n                          _context3.next = 4;\n                          break;\n                        }\n                        ElMessage.warning('请至少添加一个商品');\n                        return _context3.abrupt(\"return\");\n                      case 4:\n                        _context3.prev = 4;\n                        // 生成申请编号\n                        timestamp = new Date().getTime();\n                        code = \"PR\".concat(timestamp);\n                        url = isEdit.value ? \"/api/purchase/requisitions/\".concat(route.query.id) : '/api/purchase/requisitions';\n                        method = isEdit.value ? 'PUT' : 'POST';\n                        _context3.next = 11;\n                        return fetch(url, {\n                          method: method,\n                          headers: {\n                            'Content-Type': 'application/json'\n                          },\n                          body: JSON.stringify(_objectSpread(_objectSpread({}, form), {}, {\n                            code: code,\n                            amount: totalAmount.value\n                          }))\n                        });\n                      case 11:\n                        response = _context3.sent;\n                        _context3.next = 14;\n                        return response.json();\n                      case 14:\n                        result = _context3.sent;\n                        if (result.code === 0) {\n                          ElMessage.success(isEdit.value ? '更新成功' : '创建成功');\n                          router.push('/dashboard/purchase/requisition');\n                        } else {\n                          ElMessage.error(result.message || (isEdit.value ? '更新失败' : '创建失败'));\n                        }\n                        _context3.next = 22;\n                        break;\n                      case 18:\n                        _context3.prev = 18;\n                        _context3.t0 = _context3[\"catch\"](4);\n                        console.error(isEdit.value ? '更新采购申请失败:' : '创建采购申请失败:', _context3.t0);\n                        ElMessage.error(isEdit.value ? '更新失败' : '创建失败');\n                      case 22:\n                      case \"end\":\n                        return _context3.stop();\n                    }\n                  }, _callee3, null, [[4, 18]]);\n                }));\n                return function (_x) {\n                  return _ref5.apply(this, arguments);\n                };\n              }());\n            case 4:\n            case \"end\":\n              return _context4.stop();\n          }\n        }, _callee4);\n      }));\n      return function handleSubmit() {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n\n    // 取消\n    var handleCancel = function handleCancel() {\n      ElMessageBox.confirm('确认放弃当前编辑的内容？', '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      }).then(function () {\n        router.push('/dashboard/purchase/requisition');\n      })[\"catch\"](function () {});\n    };\n\n    // 获取采购申请详情\n    var getRequisitionDetail = /*#__PURE__*/function () {\n      var _ref6 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee5(id) {\n        var response, result, _result$data, dealerId, dealer, remark, items;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return fetch(\"/api/purchase/requisitions/\".concat(id));\n            case 3:\n              response = _context5.sent;\n              _context5.next = 6;\n              return response.json();\n            case 6:\n              result = _context5.sent;\n              if (result.code === 0) {\n                _result$data = result.data, dealerId = _result$data.dealerId, dealer = _result$data.dealer, remark = _result$data.remark, items = _result$data.items;\n                Object.assign(form, {\n                  dealerId: dealerId,\n                  dealer: dealer,\n                  remark: remark,\n                  items: items\n                });\n              }\n              _context5.next = 13;\n              break;\n            case 10:\n              _context5.prev = 10;\n              _context5.t0 = _context5[\"catch\"](0);\n              console.error('获取采购申请详情失败:', _context5.t0);\n            case 13:\n            case \"end\":\n              return _context5.stop();\n          }\n        }, _callee5, null, [[0, 10]]);\n      }));\n      return function getRequisitionDetail(_x2) {\n        return _ref6.apply(this, arguments);\n      };\n    }();\n    onMounted(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n      return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n        while (1) switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return Promise.all([getDealers(), getProducts()]);\n          case 2:\n            if (!isEdit.value) {\n              _context6.next = 5;\n              break;\n            }\n            _context6.next = 5;\n            return getRequisitionDetail(route.query.id);\n          case 5:\n          case \"end\":\n            return _context6.stop();\n        }\n      }, _callee6);\n    })));\n    var __returned__ = {\n      route: route,\n      router: router,\n      formRef: formRef,\n      isEdit: isEdit,\n      form: form,\n      rules: rules,\n      dealers: dealers,\n      products: products,\n      getDealers: getDealers,\n      getProducts: getProducts,\n      handleDealerChange: handleDealerChange,\n      handleProductChange: handleProductChange,\n      handleAddItem: handleAddItem,\n      handleDeleteItem: handleDeleteItem,\n      calculateItemAmount: calculateItemAmount,\n      formatAmount: formatAmount,\n      totalAmount: totalAmount,\n      handleSubmit: handleSubmit,\n      handleCancel: handleCancel,\n      getRequisitionDetail: getRequisitionDetail,\n      ref: ref,\n      reactive: reactive,\n      computed: computed,\n      onMounted: onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      },\n      get ElMessage() {\n        return ElMessage;\n      },\n      get ElMessageBox() {\n        return ElMessageBox;\n      },\n      get Delete() {\n        return Delete;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"names":["ref","reactive","computed","onMounted","useRoute","useRouter","ElMessage","ElMessageBox","Delete","route","router","formRef","isEdit","query","id","undefined","form","dealerId","dealer","remark","items","rules","required","message","trigger","dealers","products","getDealers","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","response","result","wrap","_callee$","_context","prev","next","fetch","sent","json","code","value","data","t0","console","error","stop","apply","arguments","getProducts","_ref3","_callee2","params","_callee2$","_context2","URLSearchParams","pageNum","pageSize","concat","toString","list","handleDealerChange","find","item","name","handleProductChange","productId","index","product","_objectSpread","productName","productSpec","spec","unit","price","calculateItemAmount","handleAddItem","push","quantity","amount","handleDeleteItem","splice","formatAmount","Number","toFixed","totalAmount","reduce","sum","handleSubmit","_ref4","_callee4","_callee4$","_context4","abrupt","validate","_ref5","_callee3","valid","timestamp","url","method","_callee3$","_context3","length","warning","Date","getTime","headers","body","JSON","stringify","success","_x","handleCancel","confirm","confirmButtonText","cancelButtonText","type","then","getRequisitionDetail","_ref6","_callee5","_result$data","_callee5$","_context5","Object","assign","_x2","_callee6","_callee6$","_context6","Promise","all"],"sources":["C:/Users/indexae/Desktop/scm日志/scm/frontend/src/views/purchase/requisition/form.vue"],"sourcesContent":["<template>\r\n  <div class=\"requisition-form\">\r\n    <el-card class=\"box-card\">\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>{{ isEdit ? '编辑采购申请' : '新建采购申请' }}</span>\r\n        </div>\r\n      </template>\r\n\r\n      <el-form ref=\"formRef\" :model=\"form\" :rules=\"rules\" label-width=\"100px\">\r\n        <!-- 基本信息 -->\r\n        <el-form-item label=\"经销商\" prop=\"dealerId\">\r\n          <el-select v-model=\"form.dealerId\" placeholder=\"请选择经销商\" @change=\"handleDealerChange\">\r\n            <el-option\r\n              v-for=\"item in dealers\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.id\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"备注\" prop=\"remark\">\r\n          <el-input\r\n            v-model=\"form.remark\"\r\n            type=\"textarea\"\r\n            :rows=\"2\"\r\n            placeholder=\"请输入备注信息\"\r\n          />\r\n        </el-form-item>\r\n\r\n        <!-- 商品明细 -->\r\n        <div class=\"items-section\">\r\n          <div class=\"items-header\">\r\n            <h3>商品明细</h3>\r\n            <el-button type=\"primary\" @click=\"handleAddItem\">添加商品</el-button>\r\n          </div>\r\n\r\n          <el-table :data=\"form.items\" border style=\"width: 100%\">\r\n            <el-table-column label=\"商品名称\" width=\"200\">\r\n              <template #default=\"scope\">\r\n                <el-select \r\n                  v-model=\"scope.row.productId\" \r\n                  placeholder=\"请选择商品\"\r\n                  @change=\"(val) => handleProductChange(val, scope.$index)\"\r\n                >\r\n                  <el-option\r\n                    v-for=\"item in products\"\r\n                    :key=\"item.id\"\r\n                    :label=\"item.name\"\r\n                    :value=\"item.id\"\r\n                  />\r\n                </el-select>\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"productSpec\" label=\"规格\" width=\"150\" />\r\n            <el-table-column prop=\"unit\" label=\"单位\" width=\"180\" />\r\n            <el-table-column label=\"数量\" width=\"200\">\r\n              <template #default=\"scope\">\r\n                <el-input-number \r\n                  v-model=\"scope.row.quantity\" \r\n                  :min=\"1\"\r\n                  @change=\"calculateItemAmount(scope.$index)\"\r\n                />\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"单价\" width=\"200\">\r\n              <template #default=\"scope\">\r\n                <el-input-number \r\n                  v-model=\"scope.row.price\" \r\n                  :min=\"0\"\r\n                  :precision=\"2\"\r\n                  @change=\"calculateItemAmount(scope.$index)\"\r\n                />\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column prop=\"amount\" label=\"金额\" width=\"120\">\r\n              <template #default=\"scope\">\r\n                {{ formatAmount(scope.row.amount) }}\r\n              </template>\r\n            </el-table-column>\r\n            <el-table-column label=\"操作\" width=\"120\">\r\n              <template #default=\"scope\">\r\n                <el-button \r\n                  type=\"danger\" \r\n                  circle\r\n                  @click=\"handleDeleteItem(scope.$index)\"\r\n                >\r\n                  <el-icon><Delete /></el-icon>\r\n                </el-button>\r\n              </template>\r\n            </el-table-column>\r\n          </el-table>\r\n        </div>\r\n\r\n        <!-- 合计金额 -->\r\n        <div class=\"total-amount\">\r\n          合计金额：{{ formatAmount(totalAmount) }}\r\n        </div>\r\n\r\n        <!-- 表单操作按钮 -->\r\n        <div class=\"form-actions\">\r\n          <el-button @click=\"handleCancel\">取消</el-button>\r\n          <el-button type=\"primary\" @click=\"handleSubmit\">提交</el-button>\r\n        </div>\r\n      </el-form>\r\n    </el-card>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, computed, onMounted } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { Delete } from '@element-plus/icons-vue'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst formRef = ref(null)\r\n\r\n// 是否为编辑模式\r\nconst isEdit = computed(() => route.query.id !== undefined)\r\n\r\n// 表单数据\r\nconst form = reactive({\r\n  dealerId: '',\r\n  dealer: '',\r\n  remark: '',\r\n  items: []\r\n})\r\n\r\n// 表单验证规则\r\nconst rules = {\r\n  dealerId: [\r\n    { required: true, message: '请选择经销商', trigger: 'change' }\r\n  ]\r\n}\r\n\r\n// 经销商列表\r\nconst dealers = ref([])\r\n// 商品列表\r\nconst products = ref([])\r\n\r\n// 获取经销商列表\r\nconst getDealers = async () => {\r\n  try {\r\n    const response = await fetch('/api/dealers')\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      dealers.value = result.data\r\n    }\r\n  } catch (error) {\r\n    console.error('获取经销商列表失败:', error)\r\n  }\r\n}\r\n\r\n// 获取商品列表\r\nconst getProducts = async () => {\r\n  try {\r\n    const params = new URLSearchParams({\r\n      pageNum: '1',\r\n      pageSize: '1000'  // 获取足够多的商品以供选择\r\n    })\r\n    const response = await fetch(`/api/products?${params.toString()}`)\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      products.value = result.data.list || []\r\n    }\r\n  } catch (error) {\r\n    console.error('获取商品列表失败:', error)\r\n  }\r\n}\r\n\r\n// 处理经销商选择变化\r\nconst handleDealerChange = (dealerId) => {\r\n  const dealer = dealers.value.find(item => item.id === dealerId)\r\n  if (dealer) {\r\n    form.dealer = dealer.name\r\n  }\r\n}\r\n\r\n// 处理商品选择变化\r\nconst handleProductChange = (productId, index) => {\r\n  const product = products.value.find(item => item.id === productId)\r\n  if (product) {\r\n    form.items[index] = {\r\n      ...form.items[index],\r\n      productName: product.name,\r\n      productSpec: product.spec,\r\n      unit: product.unit,\r\n      price: product.price\r\n    }\r\n    calculateItemAmount(index)\r\n  }\r\n}\r\n\r\n// 添加商品明细\r\nconst handleAddItem = () => {\r\n  form.items.push({\r\n    productId: '',\r\n    productName: '',\r\n    productSpec: '',\r\n    unit: '',\r\n    quantity: 1,\r\n    price: 0,\r\n    amount: 0\r\n  })\r\n}\r\n\r\n// 删除商品明细\r\nconst handleDeleteItem = (index) => {\r\n  form.items.splice(index, 1)\r\n}\r\n\r\n// 计算商品金额\r\nconst calculateItemAmount = (index) => {\r\n  const item = form.items[index]\r\n  item.amount = item.quantity * item.price\r\n}\r\n\r\n// 格式化金额\r\nconst formatAmount = (amount) => {\r\n  if (!amount) return '0.00'\r\n  return Number(amount).toFixed(2)\r\n}\r\n\r\n// 计算总金额\r\nconst totalAmount = computed(() => {\r\n  return form.items.reduce((sum, item) => sum + (item.amount || 0), 0)\r\n})\r\n\r\n// 提交表单\r\nconst handleSubmit = async () => {\r\n  if (!formRef.value) return\r\n  \r\n  await formRef.value.validate(async (valid) => {\r\n    if (valid) {\r\n      if (form.items.length === 0) {\r\n        ElMessage.warning('请至少添加一个商品')\r\n        return\r\n      }\r\n\r\n      try {\r\n        // 生成申请编号\r\n        const timestamp = new Date().getTime()\r\n        const code = `PR${timestamp}`\r\n\r\n        const url = isEdit.value \r\n          ? `/api/purchase/requisitions/${route.query.id}`\r\n          : '/api/purchase/requisitions'\r\n        \r\n        const method = isEdit.value ? 'PUT' : 'POST'\r\n        const response = await fetch(url, {\r\n          method,\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify({\r\n            ...form,\r\n            code,\r\n            amount: totalAmount.value\r\n          })\r\n        })\r\n\r\n        const result = await response.json()\r\n        if (result.code === 0) {\r\n          ElMessage.success(isEdit.value ? '更新成功' : '创建成功')\r\n          router.push('/dashboard/purchase/requisition')\r\n        } else {\r\n          ElMessage.error(result.message || (isEdit.value ? '更新失败' : '创建失败'))\r\n        }\r\n      } catch (error) {\r\n        console.error(isEdit.value ? '更新采购申请失败:' : '创建采购申请失败:', error)\r\n        ElMessage.error(isEdit.value ? '更新失败' : '创建失败')\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\n// 取消\r\nconst handleCancel = () => {\r\n  ElMessageBox.confirm(\r\n    '确认放弃当前编辑的内容？',\r\n    '警告',\r\n    {\r\n      confirmButtonText: '确定',\r\n      cancelButtonText: '取消',\r\n      type: 'warning',\r\n    }\r\n  ).then(() => {\r\n    router.push('/dashboard/purchase/requisition')\r\n  }).catch(() => {})\r\n}\r\n\r\n// 获取采购申请详情\r\nconst getRequisitionDetail = async (id) => {\r\n  try {\r\n    const response = await fetch(`/api/purchase/requisitions/${id}`)\r\n    const result = await response.json()\r\n    if (result.code === 0) {\r\n      const { dealerId, dealer, remark, items } = result.data\r\n      Object.assign(form, { dealerId, dealer, remark, items })\r\n    }\r\n  } catch (error) {\r\n    console.error('获取采购申请详情失败:', error)\r\n  }\r\n}\r\n\r\nonMounted(async () => {\r\n  await Promise.all([getDealers(), getProducts()])\r\n  if (isEdit.value) {\r\n    await getRequisitionDetail(route.query.id)\r\n  }\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.requisition-form {\r\n  height: 100%;\r\n}\r\n\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.items-section {\r\n  margin: 20px 0;\r\n}\r\n\r\n.items-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  margin-bottom: 10px;\r\n}\r\n\r\n.total-amount {\r\n  text-align: right;\r\n  margin: 20px 0;\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n}\r\n\r\n.form-actions {\r\n  display: flex;\r\n  justify-content: center;\r\n  gap: 20px;\r\n  margin-top: 20px;\r\n}\r\n</style> "],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AA+GA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAK;AACxD,SAASC,QAAQ,EAAEC,SAAS,QAAQ,YAAY;AAChD,SAASC,SAAS,EAAEC,YAAY,QAAQ,cAAc;AACtD,SAASC,MAAM,QAAQ,yBAAyB;;;;;;IAEhD,IAAMC,KAAK,GAAGL,QAAQ,CAAC,CAAC;IACxB,IAAMM,MAAM,GAAGL,SAAS,CAAC,CAAC;IAC1B,IAAMM,OAAO,GAAGX,GAAG,CAAC,IAAI,CAAC;;IAEzB;IACA,IAAMY,MAAM,GAAGV,QAAQ,CAAC;MAAA,OAAMO,KAAK,CAACI,KAAK,CAACC,EAAE,KAAKC,SAAS;IAAA,EAAC;;IAE3D;IACA,IAAMC,IAAI,GAAGf,QAAQ,CAAC;MACpBgB,QAAQ,EAAE,EAAE;MACZC,MAAM,EAAE,EAAE;MACVC,MAAM,EAAE,EAAE;MACVC,KAAK,EAAE;IACT,CAAC,CAAC;;IAEF;IACA,IAAMC,KAAK,GAAG;MACZJ,QAAQ,EAAE,CACR;QAAEK,QAAQ,EAAE,IAAI;QAAEC,OAAO,EAAE,QAAQ;QAAEC,OAAO,EAAE;MAAS,CAAC;IAE5D,CAAC;;IAED;IACA,IAAMC,OAAO,GAAGzB,GAAG,CAAC,EAAE,CAAC;IACvB;IACA,IAAM0B,QAAQ,GAAG1B,GAAG,CAAC,EAAE,CAAC;;IAExB;IACA,IAAM2B,UAAU;MAAA,IAAAC,KAAA,GAAAC,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAC,QAAA;QAAA,IAAAC,QAAA,EAAAC,MAAA;QAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAC,SAAAC,QAAA;UAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAE,IAAA;cAAA,OAEQC,KAAK,CAAC,cAAc,CAAC;YAAA;cAAtCP,QAAQ,GAAAI,QAAA,CAAAI,IAAA;cAAAJ,QAAA,CAAAE,IAAA;cAAA,OACON,QAAQ,CAACS,IAAI,CAAC,CAAC;YAAA;cAA9BR,MAAM,GAAAG,QAAA,CAAAI,IAAA;cACZ,IAAIP,MAAM,CAACS,IAAI,KAAK,CAAC,EAAE;gBACrBlB,OAAO,CAACmB,KAAK,GAAGV,MAAM,CAACW,IAAI;cAC7B;cAACR,QAAA,CAAAE,IAAA;cAAA;YAAA;cAAAF,QAAA,CAAAC,IAAA;cAAAD,QAAA,CAAAS,EAAA,GAAAT,QAAA;cAEDU,OAAO,CAACC,KAAK,CAAC,YAAY,EAAAX,QAAA,CAAAS,EAAO,CAAC;YAAA;YAAA;cAAA,OAAAT,QAAA,CAAAY,IAAA;UAAA;QAAA,GAAAjB,OAAA;MAAA,CAErC;MAAA,gBAVKL,UAAUA,CAAA;QAAA,OAAAC,KAAA,CAAAsB,KAAA,OAAAC,SAAA;MAAA;IAAA,GAUf;;IAED;IACA,IAAMC,WAAW;MAAA,IAAAC,KAAA,GAAAxB,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAAuB,SAAA;QAAA,IAAAC,MAAA,EAAAtB,QAAA,EAAAC,MAAA;QAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAqB,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAnB,IAAA,GAAAmB,SAAA,CAAAlB,IAAA;YAAA;cAAAkB,SAAA,CAAAnB,IAAA;cAEViB,MAAM,GAAG,IAAIG,eAAe,CAAC;gBACjCC,OAAO,EAAE,GAAG;gBACZC,QAAQ,EAAE,MAAM,CAAE;cACpB,CAAC,CAAC;cAAAH,SAAA,CAAAlB,IAAA;cAAA,OACqBC,KAAK,kBAAAqB,MAAA,CAAkBN,MAAM,CAACO,QAAQ,CAAC,CAAC,CAAE,CAAC;YAAA;cAA5D7B,QAAQ,GAAAwB,SAAA,CAAAhB,IAAA;cAAAgB,SAAA,CAAAlB,IAAA;cAAA,OACON,QAAQ,CAACS,IAAI,CAAC,CAAC;YAAA;cAA9BR,MAAM,GAAAuB,SAAA,CAAAhB,IAAA;cACZ,IAAIP,MAAM,CAACS,IAAI,KAAK,CAAC,EAAE;gBACrBjB,QAAQ,CAACkB,KAAK,GAAGV,MAAM,CAACW,IAAI,CAACkB,IAAI,IAAI,EAAE;cACzC;cAACN,SAAA,CAAAlB,IAAA;cAAA;YAAA;cAAAkB,SAAA,CAAAnB,IAAA;cAAAmB,SAAA,CAAAX,EAAA,GAAAW,SAAA;cAEDV,OAAO,CAACC,KAAK,CAAC,WAAW,EAAAS,SAAA,CAAAX,EAAO,CAAC;YAAA;YAAA;cAAA,OAAAW,SAAA,CAAAR,IAAA;UAAA;QAAA,GAAAK,QAAA;MAAA,CAEpC;MAAA,gBAdKF,WAAWA,CAAA;QAAA,OAAAC,KAAA,CAAAH,KAAA,OAAAC,SAAA;MAAA;IAAA,GAchB;;IAED;IACA,IAAMa,kBAAkB,GAAG,SAArBA,kBAAkBA,CAAI/C,QAAQ,EAAK;MACvC,IAAMC,MAAM,GAAGO,OAAO,CAACmB,KAAK,CAACqB,IAAI,CAAC,UAAAC,IAAI;QAAA,OAAIA,IAAI,CAACpD,EAAE,KAAKG,QAAQ;MAAA,EAAC;MAC/D,IAAIC,MAAM,EAAE;QACVF,IAAI,CAACE,MAAM,GAAGA,MAAM,CAACiD,IAAI;MAC3B;IACF,CAAC;;IAED;IACA,IAAMC,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAAIC,SAAS,EAAEC,KAAK,EAAK;MAChD,IAAMC,OAAO,GAAG7C,QAAQ,CAACkB,KAAK,CAACqB,IAAI,CAAC,UAAAC,IAAI;QAAA,OAAIA,IAAI,CAACpD,EAAE,KAAKuD,SAAS;MAAA,EAAC;MAClE,IAAIE,OAAO,EAAE;QACXvD,IAAI,CAACI,KAAK,CAACkD,KAAK,CAAC,GAAAE,aAAA,CAAAA,aAAA,KACZxD,IAAI,CAACI,KAAK,CAACkD,KAAK,CAAC;UACpBG,WAAW,EAAEF,OAAO,CAACJ,IAAI;UACzBO,WAAW,EAAEH,OAAO,CAACI,IAAI;UACzBC,IAAI,EAAEL,OAAO,CAACK,IAAI;UAClBC,KAAK,EAAEN,OAAO,CAACM;QAAK,EACrB;QACDC,mBAAmB,CAACR,KAAK,CAAC;MAC5B;IACF,CAAC;;IAED;IACA,IAAMS,aAAa,GAAG,SAAhBA,aAAaA,CAAA,EAAS;MAC1B/D,IAAI,CAACI,KAAK,CAAC4D,IAAI,CAAC;QACdX,SAAS,EAAE,EAAE;QACbI,WAAW,EAAE,EAAE;QACfC,WAAW,EAAE,EAAE;QACfE,IAAI,EAAE,EAAE;QACRK,QAAQ,EAAE,CAAC;QACXJ,KAAK,EAAE,CAAC;QACRK,MAAM,EAAE;MACV,CAAC,CAAC;IACJ,CAAC;;IAED;IACA,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAIb,KAAK,EAAK;MAClCtD,IAAI,CAACI,KAAK,CAACgE,MAAM,CAACd,KAAK,EAAE,CAAC,CAAC;IAC7B,CAAC;;IAED;IACA,IAAMQ,mBAAmB,GAAG,SAAtBA,mBAAmBA,CAAIR,KAAK,EAAK;MACrC,IAAMJ,IAAI,GAAGlD,IAAI,CAACI,KAAK,CAACkD,KAAK,CAAC;MAC9BJ,IAAI,CAACgB,MAAM,GAAGhB,IAAI,CAACe,QAAQ,GAAGf,IAAI,CAACW,KAAK;IAC1C,CAAC;;IAED;IACA,IAAMQ,YAAY,GAAG,SAAfA,YAAYA,CAAIH,MAAM,EAAK;MAC/B,IAAI,CAACA,MAAM,EAAE,OAAO,MAAM;MAC1B,OAAOI,MAAM,CAACJ,MAAM,CAAC,CAACK,OAAO,CAAC,CAAC,CAAC;IAClC,CAAC;;IAED;IACA,IAAMC,WAAW,GAAGtF,QAAQ,CAAC,YAAM;MACjC,OAAOc,IAAI,CAACI,KAAK,CAACqE,MAAM,CAAC,UAACC,GAAG,EAAExB,IAAI;QAAA,OAAKwB,GAAG,IAAIxB,IAAI,CAACgB,MAAM,IAAI,CAAC,CAAC;MAAA,GAAE,CAAC,CAAC;IACtE,CAAC,CAAC;;IAEF;IACA,IAAMS,YAAY;MAAA,IAAAC,KAAA,GAAA/D,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA8D,SAAA;QAAA,OAAA/D,mBAAA,GAAAK,IAAA,UAAA2D,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAzD,IAAA,GAAAyD,SAAA,CAAAxD,IAAA;YAAA;cAAA,IACd5B,OAAO,CAACiC,KAAK;gBAAAmD,SAAA,CAAAxD,IAAA;gBAAA;cAAA;cAAA,OAAAwD,SAAA,CAAAC,MAAA;YAAA;cAAAD,SAAA,CAAAxD,IAAA;cAAA,OAEZ5B,OAAO,CAACiC,KAAK,CAACqD,QAAQ;gBAAA,IAAAC,KAAA,GAAArE,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAoE,SAAOC,KAAK;kBAAA,IAAAC,SAAA,EAAA1D,IAAA,EAAA2D,GAAA,EAAAC,MAAA,EAAAtE,QAAA,EAAAC,MAAA;kBAAA,OAAAJ,mBAAA,GAAAK,IAAA,UAAAqE,UAAAC,SAAA;oBAAA,kBAAAA,SAAA,CAAAnE,IAAA,GAAAmE,SAAA,CAAAlE,IAAA;sBAAA;wBAAA,KACnC6D,KAAK;0BAAAK,SAAA,CAAAlE,IAAA;0BAAA;wBAAA;wBAAA,MACHvB,IAAI,CAACI,KAAK,CAACsF,MAAM,KAAK,CAAC;0BAAAD,SAAA,CAAAlE,IAAA;0BAAA;wBAAA;wBACzBjC,SAAS,CAACqG,OAAO,CAAC,WAAW,CAAC;wBAAA,OAAAF,SAAA,CAAAT,MAAA;sBAAA;wBAAAS,SAAA,CAAAnE,IAAA;wBAK9B;wBACM+D,SAAS,GAAG,IAAIO,IAAI,CAAC,CAAC,CAACC,OAAO,CAAC,CAAC;wBAChClE,IAAI,QAAAkB,MAAA,CAAQwC,SAAS;wBAErBC,GAAG,GAAG1F,MAAM,CAACgC,KAAK,iCAAAiB,MAAA,CACUpD,KAAK,CAACI,KAAK,CAACC,EAAE,IAC5C,4BAA4B;wBAE1ByF,MAAM,GAAG3F,MAAM,CAACgC,KAAK,GAAG,KAAK,GAAG,MAAM;wBAAA6D,SAAA,CAAAlE,IAAA;wBAAA,OACrBC,KAAK,CAAC8D,GAAG,EAAE;0BAChCC,MAAM,EAANA,MAAM;0BACNO,OAAO,EAAE;4BACP,cAAc,EAAE;0BAClB,CAAC;0BACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAAzC,aAAA,CAAAA,aAAA,KACfxD,IAAI;4BACP2B,IAAI,EAAJA,IAAI;4BACJuC,MAAM,EAAEM,WAAW,CAAC5C;0BAAK,EAC1B;wBACH,CAAC,CAAC;sBAAA;wBAVIX,QAAQ,GAAAwE,SAAA,CAAAhE,IAAA;wBAAAgE,SAAA,CAAAlE,IAAA;wBAAA,OAYON,QAAQ,CAACS,IAAI,CAAC,CAAC;sBAAA;wBAA9BR,MAAM,GAAAuE,SAAA,CAAAhE,IAAA;wBACZ,IAAIP,MAAM,CAACS,IAAI,KAAK,CAAC,EAAE;0BACrBrC,SAAS,CAAC4G,OAAO,CAACtG,MAAM,CAACgC,KAAK,GAAG,MAAM,GAAG,MAAM,CAAC;0BACjDlC,MAAM,CAACsE,IAAI,CAAC,iCAAiC,CAAC;wBAChD,CAAC,MAAM;0BACL1E,SAAS,CAAC0C,KAAK,CAACd,MAAM,CAACX,OAAO,KAAKX,MAAM,CAACgC,KAAK,GAAG,MAAM,GAAG,MAAM,CAAC,CAAC;wBACrE;wBAAC6D,SAAA,CAAAlE,IAAA;wBAAA;sBAAA;wBAAAkE,SAAA,CAAAnE,IAAA;wBAAAmE,SAAA,CAAA3D,EAAA,GAAA2D,SAAA;wBAED1D,OAAO,CAACC,KAAK,CAACpC,MAAM,CAACgC,KAAK,GAAG,WAAW,GAAG,WAAW,EAAA6D,SAAA,CAAA3D,EAAO,CAAC;wBAC9DxC,SAAS,CAAC0C,KAAK,CAACpC,MAAM,CAACgC,KAAK,GAAG,MAAM,GAAG,MAAM,CAAC;sBAAA;sBAAA;wBAAA,OAAA6D,SAAA,CAAAxD,IAAA;oBAAA;kBAAA,GAAAkD,QAAA;gBAAA,CAGpD;gBAAA,iBAAAgB,EAAA;kBAAA,OAAAjB,KAAA,CAAAhD,KAAA,OAAAC,SAAA;gBAAA;cAAA,IAAC;YAAA;YAAA;cAAA,OAAA4C,SAAA,CAAA9C,IAAA;UAAA;QAAA,GAAA4C,QAAA;MAAA,CACH;MAAA,gBA7CKF,YAAYA,CAAA;QAAA,OAAAC,KAAA,CAAA1C,KAAA,OAAAC,SAAA;MAAA;IAAA,GA6CjB;;IAED;IACA,IAAMiE,YAAY,GAAG,SAAfA,YAAYA,CAAA,EAAS;MACzB7G,YAAY,CAAC8G,OAAO,CAClB,cAAc,EACd,IAAI,EACJ;QACEC,iBAAiB,EAAE,IAAI;QACvBC,gBAAgB,EAAE,IAAI;QACtBC,IAAI,EAAE;MACR,CACF,CAAC,CAACC,IAAI,CAAC,YAAM;QACX/G,MAAM,CAACsE,IAAI,CAAC,iCAAiC,CAAC;MAChD,CAAC,CAAC,SAAM,CAAC,YAAM,CAAC,CAAC,CAAC;IACpB,CAAC;;IAED;IACA,IAAM0C,oBAAoB;MAAA,IAAAC,KAAA,GAAA9F,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAG,SAAA6F,SAAO9G,EAAE;QAAA,IAAAmB,QAAA,EAAAC,MAAA,EAAA2F,YAAA,EAAA5G,QAAA,EAAAC,MAAA,EAAAC,MAAA,EAAAC,KAAA;QAAA,OAAAU,mBAAA,GAAAK,IAAA,UAAA2F,UAAAC,SAAA;UAAA,kBAAAA,SAAA,CAAAzF,IAAA,GAAAyF,SAAA,CAAAxF,IAAA;YAAA;cAAAwF,SAAA,CAAAzF,IAAA;cAAAyF,SAAA,CAAAxF,IAAA;cAAA,OAEXC,KAAK,+BAAAqB,MAAA,CAA+B/C,EAAE,CAAE,CAAC;YAAA;cAA1DmB,QAAQ,GAAA8F,SAAA,CAAAtF,IAAA;cAAAsF,SAAA,CAAAxF,IAAA;cAAA,OACON,QAAQ,CAACS,IAAI,CAAC,CAAC;YAAA;cAA9BR,MAAM,GAAA6F,SAAA,CAAAtF,IAAA;cACZ,IAAIP,MAAM,CAACS,IAAI,KAAK,CAAC,EAAE;gBAAAkF,YAAA,GACuB3F,MAAM,CAACW,IAAI,EAA/C5B,QAAQ,GAAA4G,YAAA,CAAR5G,QAAQ,EAAEC,MAAM,GAAA2G,YAAA,CAAN3G,MAAM,EAAEC,MAAM,GAAA0G,YAAA,CAAN1G,MAAM,EAAEC,KAAK,GAAAyG,YAAA,CAALzG,KAAK;gBACvC4G,MAAM,CAACC,MAAM,CAACjH,IAAI,EAAE;kBAAEC,QAAQ,EAARA,QAAQ;kBAAEC,MAAM,EAANA,MAAM;kBAAEC,MAAM,EAANA,MAAM;kBAAEC,KAAK,EAALA;gBAAM,CAAC,CAAC;cAC1D;cAAC2G,SAAA,CAAAxF,IAAA;cAAA;YAAA;cAAAwF,SAAA,CAAAzF,IAAA;cAAAyF,SAAA,CAAAjF,EAAA,GAAAiF,SAAA;cAEDhF,OAAO,CAACC,KAAK,CAAC,aAAa,EAAA+E,SAAA,CAAAjF,EAAO,CAAC;YAAA;YAAA;cAAA,OAAAiF,SAAA,CAAA9E,IAAA;UAAA;QAAA,GAAA2E,QAAA;MAAA,CAEtC;MAAA,gBAXKF,oBAAoBA,CAAAQ,GAAA;QAAA,OAAAP,KAAA,CAAAzE,KAAA,OAAAC,SAAA;MAAA;IAAA,GAWzB;IAEDhD,SAAS,cAAA0B,iBAAA,cAAAC,mBAAA,GAAAC,IAAA,CAAC,SAAAoG,SAAA;MAAA,OAAArG,mBAAA,GAAAK,IAAA,UAAAiG,UAAAC,SAAA;QAAA,kBAAAA,SAAA,CAAA/F,IAAA,GAAA+F,SAAA,CAAA9F,IAAA;UAAA;YAAA8F,SAAA,CAAA9F,IAAA;YAAA,OACF+F,OAAO,CAACC,GAAG,CAAC,CAAC5G,UAAU,CAAC,CAAC,EAAEyB,WAAW,CAAC,CAAC,CAAC,CAAC;UAAA;YAAA,KAC5CxC,MAAM,CAACgC,KAAK;cAAAyF,SAAA,CAAA9F,IAAA;cAAA;YAAA;YAAA8F,SAAA,CAAA9F,IAAA;YAAA,OACRmF,oBAAoB,CAACjH,KAAK,CAACI,KAAK,CAACC,EAAE,CAAC;UAAA;UAAA;YAAA,OAAAuH,SAAA,CAAApF,IAAA;QAAA;MAAA,GAAAkF,QAAA;IAAA,CAE7C,GAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}