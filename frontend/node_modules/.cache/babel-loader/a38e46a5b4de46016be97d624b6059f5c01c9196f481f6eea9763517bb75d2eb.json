{"ast":null,"code":"import { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, toDisplayString as _toDisplayString, resolveComponent as _resolveComponent, createVNode as _createVNode, withModifiers as _withModifiers, withCtx as _withCtx, createTextVNode as _createTextVNode, normalizeClass as _normalizeClass, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, vShow as _vShow, normalizeStyle as _normalizeStyle, withDirectives as _withDirectives } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"tags-view-container\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  var _component_Close = _resolveComponent(\"Close\");\n  var _component_el_icon = _resolveComponent(\"el-icon\");\n  var _component_router_link = _resolveComponent(\"router-link\");\n  var _component_el_scrollbar = _resolveComponent(\"el-scrollbar\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_el_scrollbar, {\n    \"class\": \"tags-view-wrapper\"\n  }, {\n    \"default\": _withCtx(function () {\n      return [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.visitedViews, function (tag) {\n        return _openBlock(), _createBlock(_component_router_link, {\n          key: tag.path,\n          \"class\": _normalizeClass([$setup.isActive(tag) ? 'active' : '', \"tags-view-item\"]),\n          to: {\n            path: tag.path,\n            query: tag.query,\n            fullPath: tag.fullPath\n          },\n          onContextmenu: _withModifiers(function ($event) {\n            return $setup.openMenu($event, tag);\n          }, [\"prevent\"])\n        }, {\n          \"default\": _withCtx(function () {\n            return [_createTextVNode(_toDisplayString(tag.title) + \" \", 1 /* TEXT */), _createVNode(_component_el_icon, {\n              \"class\": \"el-icon-close\",\n              onClick: _withModifiers(function ($event) {\n                return $setup.closeSelectedTag(tag);\n              }, [\"prevent\", \"stop\"])\n            }, {\n              \"default\": _withCtx(function () {\n                return [_createVNode(_component_Close)];\n              }),\n              _: 2 /* DYNAMIC */\n            }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"onClick\"])];\n          }),\n          _: 2 /* DYNAMIC */\n        }, 1032 /* PROPS, DYNAMIC_SLOTS */, [\"class\", \"to\", \"onContextmenu\"]);\n      }), 128 /* KEYED_FRAGMENT */))];\n    }),\n    _: 1 /* STABLE */\n  }), _createCommentVNode(\" 右键菜单 \"), _withDirectives(_createElementVNode(\"ul\", {\n    style: _normalizeStyle({\n      left: $setup.left + 'px',\n      top: $setup.top + 'px'\n    }),\n    \"class\": \"contextmenu\"\n  }, [_createElementVNode(\"li\", {\n    onClick: _cache[0] || (_cache[0] = function ($event) {\n      return $setup.refreshSelectedTag($setup.selectedTag);\n    })\n  }, \"刷新页面\"), _createElementVNode(\"li\", {\n    onClick: _cache[1] || (_cache[1] = function ($event) {\n      return $setup.closeSelectedTag($setup.selectedTag);\n    })\n  }, \"关闭当前\"), _createElementVNode(\"li\", {\n    onClick: $setup.closeOthersTags\n  }, \"关闭其他\"), _createElementVNode(\"li\", {\n    onClick: $setup.closeAllTags\n  }, \"关闭所有\")], 4 /* STYLE */), [[_vShow, $setup.visible]])]);\n}","map":{"version":3,"names":["_createElementBlock","_hoisted_1","_createVNode","_component_el_scrollbar","_withCtx","_Fragment","_renderList","$setup","visitedViews","tag","_createBlock","_component_router_link","key","path","_normalizeClass","isActive","to","query","fullPath","onContextmenu","_withModifiers","$event","openMenu","_createTextVNode","_toDisplayString","title","_component_el_icon","onClick","closeSelectedTag","_component_Close","_","_createCommentVNode","_createElementVNode","style","_normalizeStyle","left","top","_cache","refreshSelectedTag","selectedTag","closeOthersTags","closeAllTags","visible"],"sources":["C:\\Users\\indexae\\Desktop\\scm退货\\scm\\frontend\\src\\layout\\components\\TagsView\\index.vue"],"sourcesContent":["<template>\r\n  <div class=\"tags-view-container\">\r\n    <el-scrollbar class=\"tags-view-wrapper\">\r\n      <router-link\r\n        v-for=\"tag in visitedViews\"\r\n        :key=\"tag.path\"\r\n        :class=\"isActive(tag) ? 'active' : ''\"\r\n        :to=\"{ path: tag.path, query: tag.query, fullPath: tag.fullPath }\"\r\n        class=\"tags-view-item\"\r\n        @contextmenu.prevent=\"openMenu($event, tag)\">\r\n        {{ tag.title }}\r\n        <el-icon \r\n          class=\"el-icon-close\" \r\n          @click.prevent.stop=\"closeSelectedTag(tag)\">\r\n          <Close />\r\n        </el-icon>\r\n      </router-link>\r\n    </el-scrollbar>\r\n    \r\n    <!-- 右键菜单 -->\r\n    <ul v-show=\"visible\" :style=\"{left: left+'px', top: top+'px'}\" class=\"contextmenu\">\r\n      <li @click=\"refreshSelectedTag(selectedTag)\">刷新页面</li>\r\n      <li @click=\"closeSelectedTag(selectedTag)\">关闭当前</li>\r\n      <li @click=\"closeOthersTags\">关闭其他</li>\r\n      <li @click=\"closeAllTags\">关闭所有</li>\r\n    </ul>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed, watch, onMounted, onBeforeUnmount } from 'vue'\r\nimport { useRoute, useRouter } from 'vue-router'\r\nimport { useTagsViewStore } from '@/stores/tagsView'\r\n\r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst tagsViewStore = useTagsViewStore()\r\n\r\n// 访问过的视图\r\nconst visitedViews = computed(() => tagsViewStore.visitedViews)\r\n\r\n// 右键菜单相关\r\nconst visible = ref(false)\r\nconst top = ref(0)\r\nconst left = ref(0)\r\nconst selectedTag = ref(null)\r\n\r\n// 判断是否是激活的标签\r\nconst isActive = (tag) => {\r\n  return tag.path === route.path\r\n}\r\n\r\n// 添加视图\r\nconst addTags = () => {\r\n  const { name, path, meta, fullPath, query } = route\r\n  if (name) {\r\n    tagsViewStore.addView({\r\n      title: meta.title || 'no-name',\r\n      name,\r\n      path,\r\n      fullPath,\r\n      query\r\n    })\r\n  }\r\n}\r\n\r\n// 刷新选中的标签\r\nconst refreshSelectedTag = (view) => {\r\n  router.replace({\r\n    path: '/redirect' + view.path,\r\n    query: view.query\r\n  })\r\n}\r\n\r\n// 关闭选中的标签\r\nconst closeSelectedTag = async (view) => {\r\n  await tagsViewStore.delView(view)\r\n  if (isActive(view)) {\r\n    toLastView()\r\n  }\r\n}\r\n\r\n// 关闭其他标签\r\nconst closeOthersTags = async () => {\r\n  await tagsViewStore.delOthersViews(selectedTag.value)\r\n  router.push(selectedTag.value.path)\r\n}\r\n\r\n// 关闭所有标签\r\nconst closeAllTags = async () => {\r\n  await tagsViewStore.delAllViews()\r\n  router.push('/')\r\n}\r\n\r\n// 打开右键菜单\r\nconst openMenu = (e, tag) => {\r\n  const menuMinWidth = 105\r\n  const offsetLeft = document.querySelector('.tags-view-container').getBoundingClientRect().left\r\n  const offsetWidth = document.querySelector('.tags-view-container').offsetWidth\r\n  const maxLeft = offsetWidth - menuMinWidth\r\n  const left = e.clientX - offsetLeft + 15\r\n\r\n  if (left > maxLeft) {\r\n    left.value = maxLeft\r\n  } else {\r\n    left.value = left\r\n  }\r\n  top.value = e.clientY\r\n\r\n  visible.value = true\r\n  selectedTag.value = tag\r\n}\r\n\r\n// 关闭右键菜单\r\nconst closeMenu = () => {\r\n  visible.value = false\r\n}\r\n\r\n// 跳转到最后一个标签\r\nconst toLastView = () => {\r\n  const latestView = visitedViews.value.slice(-1)[0]\r\n  if (latestView) {\r\n    router.push(latestView.path)\r\n  } else {\r\n    router.push('/')\r\n  }\r\n}\r\n\r\n// 监听路由变化\r\nwatch(\r\n  () => route.path,\r\n  () => {\r\n    addTags()\r\n  }\r\n)\r\n\r\n// 点击空白处关闭右键菜单\r\nconst handleClickOutside = (e) => {\r\n  const menu = document.querySelector('.contextmenu')\r\n  if (!menu?.contains(e.target)) {\r\n    closeMenu()\r\n  }\r\n}\r\n\r\nonMounted(() => {\r\n  document.addEventListener('click', handleClickOutside)\r\n  addTags()\r\n})\r\n\r\nonBeforeUnmount(() => {\r\n  document.removeEventListener('click', handleClickOutside)\r\n})\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.tags-view-container {\r\n  height: 34px;\r\n  width: 100%;\r\n  background: #fff;\r\n  border-bottom: 1px solid #d8dce5;\r\n  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, .12), 0 0 3px 0 rgba(0, 0, 0, .04);\r\n  \r\n  .tags-view-wrapper {\r\n    .tags-view-item {\r\n      display: inline-block;\r\n      position: relative;\r\n      cursor: pointer;\r\n      height: 26px;\r\n      line-height: 26px;\r\n      border: 1px solid #d8dce5;\r\n      color: #495060;\r\n      background: #fff;\r\n      padding: 0 8px;\r\n      font-size: 12px;\r\n      margin-left: 5px;\r\n      margin-top: 4px;\r\n      text-decoration: none;\r\n      \r\n      &:first-of-type {\r\n        margin-left: 15px;\r\n      }\r\n      \r\n      &:last-of-type {\r\n        margin-right: 15px;\r\n      }\r\n      \r\n      &.active {\r\n        background-color: var(--el-color-primary);\r\n        color: #fff;\r\n        border-color: var(--el-color-primary);\r\n        \r\n        &::before {\r\n          content: '';\r\n          background: #fff;\r\n          display: inline-block;\r\n          width: 8px;\r\n          height: 8px;\r\n          border-radius: 50%;\r\n          position: relative;\r\n          margin-right: 4px;\r\n        }\r\n      }\r\n      \r\n      .el-icon-close {\r\n        width: 16px;\r\n        height: 16px;\r\n        vertical-align: 2px;\r\n        border-radius: 50%;\r\n        text-align: center;\r\n        transition: all .3s cubic-bezier(.645, .045, .355, 1);\r\n        transform-origin: 100% 50%;\r\n        \r\n        &:before {\r\n          transform: scale(.6);\r\n          display: inline-block;\r\n          vertical-align: -3px;\r\n        }\r\n        \r\n        &:hover {\r\n          background-color: #b4bccc;\r\n          color: #fff;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  \r\n  .contextmenu {\r\n    margin: 0;\r\n    background: #fff;\r\n    z-index: 3000;\r\n    position: absolute;\r\n    list-style-type: none;\r\n    padding: 5px 0;\r\n    border-radius: 4px;\r\n    font-size: 12px;\r\n    font-weight: 400;\r\n    color: #333;\r\n    box-shadow: 2px 2px 3px 0 rgba(0, 0, 0, .3);\r\n    \r\n    li {\r\n      margin: 0;\r\n      padding: 7px 16px;\r\n      cursor: pointer;\r\n      \r\n      &:hover {\r\n        background: #eee;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style> "],"mappings":";;EACO,SAAM;AAAqB;;;;;;uBAAhCA,mBAAA,CAyBM,OAzBNC,UAyBM,GAxBJC,YAAA,CAeeC,uBAAA;IAfD,SAAM;EAAmB;IAF3C,WAAAC,QAAA,CAIQ;MAAA,OAA2B,E,kBAD7BJ,mBAAA,CAacK,SAAA,QAhBpBC,WAAA,CAIsBC,MAAA,CAAAC,YAAY,EAJlC,UAIeC,GAAG;6BADZC,YAAA,CAacC,sBAAA;UAXXC,GAAG,EAAEH,GAAG,CAACI,IAAI;UACb,SANTC,eAAA,EAMgBP,MAAA,CAAAQ,QAAQ,CAACN,GAAG,mBAEd,gBAAgB;UADrBO,EAAE;YAAAH,IAAA,EAAUJ,GAAG,CAACI,IAAI;YAAAI,KAAA,EAASR,GAAG,CAACQ,KAAK;YAAAC,QAAA,EAAYT,GAAG,CAACS;UAAQ;UAE9DC,aAAW,EATpBC,cAAA,WAAAC,MAAA;YAAA,OAS8Bd,MAAA,CAAAe,QAAQ,CAACD,MAAM,EAAEZ,GAAG;UAAA;;UATlD,WAAAL,QAAA,CAUQ;YAAA,OAAe,CAVvBmB,gBAAA,CAAAC,gBAAA,CAUWf,GAAG,CAACgB,KAAK,IAAG,GACf,iBAAAvB,YAAA,CAIUwB,kBAAA;cAHR,SAAM,eAAe;cACpBC,OAAK,EAbhBP,cAAA,WAAAC,MAAA;gBAAA,OAa+Bd,MAAA,CAAAqB,gBAAgB,CAACnB,GAAG;cAAA;;cAbnD,WAAAL,QAAA,CAcU;gBAAA,OAAS,CAATF,YAAA,CAAS2B,gBAAA,E;;cAdnBC,CAAA;;;UAAAA,CAAA;;;;IAAAA,CAAA;MAmBIC,mBAAA,UAAa,E,gBACbC,mBAAA,CAKK;IALiBC,KAAK,EApB/BC,eAAA;MAAAC,IAAA,EAoBwC5B,MAAA,CAAA4B,IAAI;MAAAC,GAAA,EAAY7B,MAAA,CAAA6B,GAAG;IAAA;IAAQ,SAAM;MACnEJ,mBAAA,CAAsD;IAAjDL,OAAK,EAAAU,MAAA,QAAAA,MAAA,gBAAAhB,MAAA;MAAA,OAAEd,MAAA,CAAA+B,kBAAkB,CAAC/B,MAAA,CAAAgC,WAAW;IAAA;KAAG,MAAI,GACjDP,mBAAA,CAAoD;IAA/CL,OAAK,EAAAU,MAAA,QAAAA,MAAA,gBAAAhB,MAAA;MAAA,OAAEd,MAAA,CAAAqB,gBAAgB,CAACrB,MAAA,CAAAgC,WAAW;IAAA;KAAG,MAAI,GAC/CP,mBAAA,CAAsC;IAAjCL,OAAK,EAAEpB,MAAA,CAAAiC;EAAe,GAAE,MAAI,GACjCR,mBAAA,CAAmC;IAA9BL,OAAK,EAAEpB,MAAA,CAAAkC;EAAY,GAAE,MAAI,E,4BAJpBlC,MAAA,CAAAmC,OAAO,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}